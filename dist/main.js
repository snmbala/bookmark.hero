function X(){const h=document.documentElement,g=document.getElementById("settings-icon-svg");g&&(h.classList.contains("dark")?g.querySelectorAll("path").forEach(u=>{u.setAttribute("stroke","#a5b4fc")}):g.querySelectorAll("path").forEach(u=>{u.setAttribute("stroke","#4f46e5")}))}function ge(){const h=document.querySelectorAll(".theme-toggle-btn");if(!h.length)return;const g=document.documentElement;function u(f){chrome?.storage?.sync?chrome.storage.sync.get(["appearanceMode"],m=>f(m.appearanceMode||"auto")):f(localStorage.getItem("appearanceMode")||"auto")}function L(f){chrome?.storage?.sync?chrome.storage.sync.set({appearanceMode:f}):localStorage.setItem("appearanceMode",f)}function w(f){h.forEach((m,$)=>{m.classList.remove("bg-indigo-50","border-2","border-indigo-400","text-indigo-700","bg-white","text-zinc-500","dark:bg-indigo-500/10","dark:border-indigo-400","dark:text-indigo-200","dark:bg-zinc-700","dark:text-zinc-300","rounded-l-md","rounded-r-md"),m.classList.add("bg-white","text-zinc-500","dark:bg-zinc-700","dark:text-zinc-300"),$===0&&m.classList.add("rounded-l-md"),$===h.length-1&&m.classList.add("rounded-r-md"),f==="auto"&&m.getAttribute("data-theme")==="auto"||f==="light"&&m.getAttribute("data-theme")==="light"||f==="dark"&&m.getAttribute("data-theme")==="dark"?(m.classList.remove("bg-white","text-zinc-500","dark:bg-zinc-700","dark:text-zinc-300"),m.classList.add("bg-indigo-50","border-2","border-indigo-400","text-indigo-700","dark:bg-indigo-500/10","dark:border-indigo-400","dark:text-indigo-200")):m.classList.remove("border-2","border-indigo-400","text-indigo-700","dark:bg-indigo-500/10","dark:border-indigo-400","dark:text-indigo-200")})}function y(f){f==="dark"?g.classList.add("dark"):f==="light"?g.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches?g.classList.add("dark"):g.classList.remove("dark"),X()}u(f=>{w(f),y(f)}),h.forEach(f=>{f.addEventListener("click",()=>{const m=f.getAttribute("data-theme");L(m),w(m),y(m)})}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",f=>{u(m=>{m==="auto"&&y("auto")})})}function ce(h,g,u){if(!h){console.error("URL is empty");return}const L=1024,w=683;chrome.windows.create({url:h,type:"popup",width:L,height:w,left:Math.round((screen.width-L)/2),top:Math.round((screen.height-w)/2)},function(y){y.tabs[0].id,chrome.tabs.onUpdated.addListener(function f(m,$){m===m&&$.status==="complete"&&(chrome.tabs.onUpdated.removeListener(f),setTimeout(function(){chrome.tabs.captureVisibleTab(y.id,{format:"png"},function(P){P?pe(P,100,function(x){ve(h,x),u&&typeof u=="function"&&u(h,x)}):console.error("Failed to capture screenshot for URL:",h),chrome.windows.remove(y.id)})},1e3))})})}function pe(h,g,u){const L=new Image;L.src=h,L.onload=function(){const w=document.createElement("canvas"),y=w.getContext("2d");w.width=1024,w.height=683,y.drawImage(L,0,0,w.width,w.height);let f=1;for(;;){const m=w.toDataURL("image/jpeg",f);if(m.length/1024<=g||f<=.1){u(m);break}else f-=.1}}}function ve(h,g){const u=h,L=g;chrome.storage.local.set({[u]:L},function(){chrome.runtime.lastError&&console.error(chrome.runtime.lastError.message)})}function se(h,g){const u=h;chrome.storage.local.get([u],function(L){if(chrome.runtime.lastError)g(`https://www.google.com/s2/favicons?domain=${h}`);else{const w=L[u];g(w||`https://www.google.com/s2/favicons?domain=${h}`)}})}chrome.bookmarks.getTree(function(h){const g=document.getElementById("folder-list"),u=document.getElementById("search-input"),L=document.getElementById("clear-search"),w=document.getElementById("search-icon"),y=document.getElementById("filter"),f=document.getElementById("folder-view"),m=document.getElementById("recents-view"),$=document.getElementById("recents-icon"),P=document.getElementById("settings-btn");let x=0,I=!0,B=[],M=[{label:"All",value:"all",level:0,id:0}],R={data:null,timestamp:0};const re=5e3;function ae(e,t){let n;return function(...l){const s=()=>{clearTimeout(n),e(...l)};clearTimeout(n),n=setTimeout(s,t)}}function ee(){const e=Date.now();return R.data&&e-R.timestamp<re?Promise.resolve(R.data):new Promise(t=>{chrome.bookmarks.getTree(n=>{R.data=n,R.timestamp=e,t(n)})})}ge(),document.addEventListener("DOMContentLoaded",X),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",X);let _=!1;const T=document.getElementById("settings-modal");P.addEventListener("click",function(e){e.stopPropagation(),T.classList.toggle("hidden"),_=!T.classList.contains("hidden")}),T.addEventListener("click",function(e){e.stopPropagation()}),document.addEventListener("click",function(){_&&!T.classList.contains("hidden")&&(T.classList.add("hidden"),_=!1)});function G(e,t=""){if(e.children){t=e.title;for(const n of e.children)G(n,t)}else B.push({bookmark:e,folder:t})}for(const e of h[0].children)G(e);let q=B.sort((e,t)=>{const n=e.bookmark.dateLastUsed||e.bookmark.dateAdded;return(t.bookmark.dateLastUsed||t.bookmark.dateAdded)-n});const de=ae(function(e){I?S(e):U(h,e)},300);u.addEventListener("input",function(){if(u.value){L.classList.remove("hidden"),document.activeElement===u?w.src="assets/icons/search-blue.svg":w.src="assets/icons/search.svg";const e=u.value.trim().toLowerCase();de(e)}else L.classList.add("hidden"),w.src="assets/icons/search.svg",I?S(""):U(h,"")}),L.addEventListener("click",function(){u.value="",L.classList.add("hidden"),w.src="assets/icons/search.svg",I?S(""):U(h,"")}),document.addEventListener("keydown",function(e){e.key==="/"&&document.activeElement!==u&&(e.preventDefault(),u.focus()),e.key==="Escape"&&document.activeElement===u&&u.blur()});function te(){I=!I,u.value="",L.classList.add("hidden"),w.src="assets/icons/search.svg",y.value="all",x=0,W();const e="",t=document.querySelectorAll(".folder-icon"),n=document.getElementById("settings-icon-svg");I?(t.forEach(i=>{i.style.fill="none",i.style.stroke="#a1a1aa"}),f.classList.remove("active"),f.classList.add("in-active"),$.style.fill="#4f46e5",$.style.stroke="#4f46e5",m.classList.add("active"),m.classList.remove("in-active"),n&&n.querySelectorAll("path").forEach(i=>{i.setAttribute("stroke","#4f46e5")}),S(e)):(t.forEach(i=>{i.style.fill="#4f46e5",i.style.stroke="#4f46e5"}),f.classList.add("active"),f.classList.remove("in-active"),$.style.stroke="#a1a1aa",$.style.fill="none",m.classList.remove("active"),m.classList.add("in-active"),n&&n.querySelectorAll("path").forEach(i=>{i.setAttribute("stroke","#a1a1aa")}),U(h,e))}function S(e){q=B.sort((o,d)=>{const p=o.bookmark.dateLastUsed||o.bookmark.dateAdded;return(d.bookmark.dateLastUsed||d.bookmark.dateAdded)-p});let t=q.filter(o=>{const d=!e||A(o.bookmark.title,e)||A(o.bookmark.url,e);if(x&&x!==0&&x!=="all"){const p=o.bookmark.parentId==x;return d&&p}return d});g.innerHTML="";const n=document.createElement("h1");n.textContent=j(e,x,t.length),n.className="flex-start w-full font-semibold text-lg py-2 text-zinc-800 dark:text-zinc-50";const i=document.createElement("div");i.className="w-fit",g.appendChild(i);const l=document.createElement("div");l.className="container mx-auto grid my-6 grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8",i.appendChild(n),i.appendChild(l);const s=24;let r=0;function E(){const o=r*s,d=Math.min(o+s,t.length),p=document.createDocumentFragment();for(let c=o;c<d;c++){const a=t[c];if(!a.children){const k=K(a.bookmark,e);p.appendChild(k)}}if(l.appendChild(p),r++,d<t.length){const c=document.createElement("button");c.textContent=`Load More (${t.length-d} remaining)`,c.className="col-span-full mt-4 px-4 py-2 bg-indigo-500 hover:bg-indigo-600 text-white rounded-md transition-colors duration-200",c.addEventListener("click",()=>{c.remove(),E()}),l.appendChild(c)}}if(t.length>0&&E(),t.length===0){const o=document.createElement("p");o.textContent=e?`No bookmarks found matching "${e}"`:"No bookmarks found.",o.className="text-zinc-500 dark:text-zinc-400 mt-4",i.appendChild(o)}}function K(e,t){const n=document.createElement("div");n.className="relative card min-w-60 flex flex-col border-[1.5px] bg-white border-zinc-200; dark:border-zinc-700 hover:border-indigo-500 hover:shadow-md hover:shadow-indigo-100 dark:hover:shadow-indigo-700 rounded-md overflow-hidden";const i=document.createElement("button");i.className="absolute top-0 right-0 m-1 p-1 bg-zinc-500 hover:bg-zinc-600 dark:bg-zinc-700 dark:hover:bg-zinc-800 rounded-full border-none cursor-pointer close-button",i.addEventListener("click",function(b){b.stopPropagation(),ue(b,e)});const l=document.createElement("img");l.src="assets/icons/more.svg",l.alt="Close",l.className="h-4 w-4",i.appendChild(l),n.appendChild(i);const s=document.createElement("a");s.href=e.url,s.target="_blank",s.className="flex-center flex-col gap-3 card-thumbnail w-full h-40 border-b-[1.5px] bg-zinc-100 dark:bg-zinc-700 dark:border-zinc-600",se(e.url,function(b){const C=document.createElement("img");if(C.src=b,C.alt=e.url||"Bookmark thumbnail",s.appendChild(C),e.title,b.startsWith("https://www.google.com/s2/favicons?domain=")){const v=document.createElement("button");v.textContent="Capture Thumbnail",v.className="text-zinc-800 dark:text-zinc-200 border-zinc-300 dark:border-zinc-700 bg-white hover:bg-zinc-50 dark:bg-zinc-800 dark:hover:bg-zinc-900 font-semibold py-2 px-4 border shadow rounded-full",v.id="capture-"+e.url,v.addEventListener("click",function(D){D.preventDefault(),ce(e.url,e.title,function(J,F){C.src=F,v.parentNode&&v.parentNode.removeChild(v)})}),s.appendChild(v)}}),n.appendChild(s),s.addEventListener("click",function(b){const C=new Date().getTime();for(const v of B)if(v.bookmark.id===e.id){v.bookmark.dateLastUsed=C;break}});const r=document.createElement("div");r.className="flex-center h-24 flex-col bg-white dark:bg-zinc-800 px-2 py-4";const E=document.createElement("div");E.className="flex-start w-full h-5";const o=document.createElement("a");o.className="flex-start text-base font-medium text-zinc-800 dark:text-zinc-50 whitespace-nowrap overflow-hidden text-ellipsis",o.href=e.url,o.target="_blank",o.innerHTML=H(e.title||"Untitled",t),E.appendChild(o),o.addEventListener("click",function(b){const C=new Date().getTime();for(const v of B)if(v.bookmark.id===e.id){v.bookmark.dateLastUsed=C;break}}),r.appendChild(E),setTimeout(()=>{o.offsetWidth>216&&E.classList.add("text-scroll")},0);const d=document.createElement("div");d.className="flex-start w-full h-5 overflow-hidden";const p=document.createElement("p");p.className="flex-start text-zinc-800 dark:text-zinc-300 whitespace-nowrap",p.title=e.url;const c=new URL(e.url);let a=c.hostname.replace(/^www\./,"");const k=c.pathname;if(k&&k!=="/"?a=H(a,t)+`<span class="text-zinc-400 whitespace-nowrap">${H(k,t)}</span>`:a=H(a,t),p.innerHTML=a,d.appendChild(p),r.appendChild(d),I){let b="";const C=B.find(v=>v.bookmark.id===e.id);if(C&&C.folder)b=C.folder;else{const v=M.find(D=>D.value===e.parentId);v&&(b=v.label.replace(/^[-\s]+/,""))}if(b){const v=document.createElement("div");v.className="flex-start w-full mt-1";const D=document.createElement("span");D.textContent=b,D.className="flex-center w-fit h-5 px-2 py-0.5 rounded-md bg-zinc-200 dark:bg-zinc-700 dark:text-zinc-50 border border-zinc-300 dark:border-zinc-600 text-xs font-medium",v.appendChild(D),r.appendChild(v)}}return n.appendChild(r),n}m.addEventListener("click",te),f.addEventListener("click",te),y.addEventListener("change",function(e){x=e.target.value=="all"?0:e.target.value;const t=u.value.trim().toLowerCase();W(),I?S(t):U(h,t)});function A(e,t){return!e||!t?!1:t.toLowerCase().split(" ").every(i=>e.toLowerCase().includes(i))}function H(e,t){if(!t||!e)return e;const n=t.toLowerCase().split(/\s+/).filter(l=>l.length>0);let i=e;return n.forEach(l=>{const s=new RegExp(`(${l})`,"gi");i=i.replace(s,'<mark class="bg-yellow-200 dark:bg-yellow-600 dark:text-zinc-100 px-0.5 rounded-sm">$1</mark>')}),i}function j(e,t,n){const i=e&&e.trim().length>0,l=t&&t!==0&&t!=="all";let s="",r="";if(l){const E=M.find(o=>o.value==t);E&&(s=E.label.replace(/^[\s\-]*/,""),r=s.includes("- ")?s.replace(/\s*-\s*/g," > "):s)}return i&&l?n===0?`No results for "${e}" in ${r}`:`Results for "${e}" in ${r} (${n})`:i?n===0?`No results for "${e}"`:`Results for "${e}" (${n})`:l?`Folder: ${r} (${n})`:I?`Recent Bookmarks (${n})`:`Bookmarks (${n})`}function Ee(e,t){}let z=null,V=null;function ue(e,t){z&&z.remove(),V=t;const n=document.getElementById("folder-dropdown");if(n&&n.children.length===0&&M.slice(1).forEach(function(E){const o=document.createElement("option");o.value=E.value,o.textContent=E.label,o.selected=E.value===V.parentId,n.appendChild(o)}),z&&z.previousElementSibling===e.target){z.remove(),z=null;return}if(z){r();return}const i=document.createElement("div");i.className="absolute z-10 flex flex-col bg-zinc-800 w-44 h-32 rounded shadow-md text-zinc-100 hover:text-zinc-50 text-sm font-light flex-center flex-col";function l(E,o,d,p){const c=document.createElement("div");c.className="flex-start w-full h-9 px-3 py-1.5 hover:bg-zinc-700 active:bg-zinc-700";const a=document.createElement("img");a.src=o,a.alt=E,a.className="w-4 h-4 mr-3",c.appendChild(a);const k=document.createElement("button");return k.textContent=E,k.className=d||"flex-start text-left",k.addEventListener("click",p),c.appendChild(k),c}se(t.url,function(E){const o=E.startsWith("https://www.google.com/s2/favicons?domain=")?"Capture Thumbnail":"Recapture",d=l(o,"assets/icons/camera.svg",null,function(a){a.preventDefault(),ce(t.url,t.title,function(k,b){document.querySelectorAll(".card").forEach(v=>{if(v.querySelector('a[href="'+t.url+'"]')){const J=v.querySelector('img[alt="'+t.url+'"]');J&&(J.src=b);const F=v.querySelector("#capture-"+t.url);F&&F.parentNode&&F.parentNode.removeChild(F)}})}),r()});i.appendChild(d);const p=l("Edit","assets/icons/edit.svg",null,function(a){r(),a.preventDefault(),fe(t)});i.appendChild(p);const c=l("Delete","assets/icons/trash.svg","flex-grow text-left",function(a){a.preventDefault(),confirm("Are you sure you want to delete this bookmark?")&&me(t),r()});i.appendChild(c)});const s=e.target.getBoundingClientRect();i.style.top=`${s.bottom+window.scrollY+4}px`,i.style.right=`${window.innerWidth-s.right-4}px`,document.body.appendChild(i),z=i;function r(){z&&(z.remove(),z=null,document.removeEventListener("click",r))}document.addEventListener("click",r),e.stopPropagation()}function fe(e){const t=document.getElementById("edit-modal"),n=document.getElementById("edit-title"),i=document.getElementById("edit-url");n.value=e.title||"",i.value=e.url||"",t.classList.remove("hidden")}function O(){document.getElementById("edit-modal").classList.add("hidden")}function me(e){const t=e.url;chrome.bookmarks.remove(e.id,function(){console.log(`Deleted bookmark: ${e.title}`),chrome.storage.local.remove([t],function(){B=B.filter(i=>i.bookmark.id!==e.id),q=B.sort((i,l)=>{const s=i.bookmark.dateLastUsed||i.bookmark.dateAdded;return(l.bookmark.dateLastUsed||l.bookmark.dateAdded)-s});const n=u.value.trim().toLowerCase();I?S(n):ee().then(function(i){g.innerHTML="",U(i,n)})})})}function ne(e,t=0,n=""){e&&e.length>0&&e.forEach(function(i){i.children?(i.title&&M.push({label:`${t>0?"-".repeat(t-1)+" ":""}`+i.title,value:i.id,level:t,id:n+"-"+i.id+"-"}),ne(i.children,t+1,n+"-"+i.id)):i.parentId&&!M.find(l=>l.value===i.parentId)&&M.push({label:`Unknown Folder (${i.parentId})`,value:i.parentId,level:0,id:`unknown-${i.parentId}`})})}ne(h),M.forEach(function(e){const t=document.createElement("option");t.value=e.value,t.textContent=e.label,t.className="flex-center flex-col bg-zinc-100 w-44 h-32 rounded shadow-md text-zinc-800 text-sm font-normal cursor-pointer py-5",y.appendChild(t)});function W(){const e=document.getElementById("filter"),t=document.getElementById("filter-dropdown-arrow"),n=document.getElementById("filter-clear");e&&t&&n&&(e.value&&e.value!=="all"?(t.classList.add("hidden"),n.classList.remove("hidden")):(t.classList.remove("hidden"),n.classList.add("hidden")))}setTimeout(()=>{const e=document.getElementById("filter"),t=document.getElementById("filter-clear");W(),t&&t.addEventListener("click",function(){if(e){e.value="all",x=0,W();const n=u.value.trim().toLowerCase();I?S(n):U(h,n)}})},100),S("");const ie=document.getElementById("cancel-edit"),oe=document.getElementById("save-edit"),Q=document.getElementById("edit-modal");ie&&ie.addEventListener("click",function(){O()}),oe&&oe.addEventListener("click",function(){if(V){const e=document.getElementById("edit-title"),t=document.getElementById("edit-url"),n=document.getElementById("folder-dropdown"),i=e.value.trim(),l=t.value.trim(),s=n.value;i&&l&&chrome.bookmarks.update(V.id,{title:i,url:l},function(){s!==V.parentId?chrome.bookmarks.move(V.id,{parentId:s},function(){O(),le()}):(O(),le())})}}),Q&&Q.addEventListener("click",function(e){e.target===Q&&O()});function le(){const e=u.value.trim().toLowerCase();R={data:null,timestamp:0},ee().then(function(t){B=[];for(const n of t[0].children)G(n);q=B.sort((n,i)=>{const l=n.bookmark.dateLastUsed||n.bookmark.dateAdded;return(i.bookmark.dateLastUsed||i.bookmark.dateAdded)-l}),I?S(e):U(t,e)})}function Y(e){const t=M.find(n=>n.value===e);return t?t.id:`fallback-${e}`}function N(e,t){let n=0;if(e.children)for(const i of e.children)n+=N(i,t);else e.url&&(!t||A(e.title,t)||A(e.url,t))&&n++;return n}function he(e,t,n){const i=e.title,l=N(e,t),s=t&&t.trim().length>0,r=n&&n!==0&&n!=="all";return l===0?null:s&&r?`${i} - Results for "${t}" (${l})`:s?`${i} - Results for "${t}" (${l})`:r?`${i} (${l})`:`${i} (${l})`}function Z(e,t,n,i,l){const s=document.createElement("div");try{s.id=Y(e.id)}catch(r){console.error("Error computing ID for bookmark:",e.title,r),s.id=`fallback-${e.id}`}if(s.className=n||"flex-center flex-col m-auto gap-4",e.children&&e.children.length>0){const r=he(e,t,x);if(r===null)return null;const E=document.createElement("h2");try{E.id=Y(e.id)}catch(c){console.error("Error computing ID for folder title:",e.title,c),E.id=`fallback-title-${e.id}`}E.textContent=r||"Untitled",E.className=l||"container flex-start w-full text-semibold text-zinc-600 text-lg py-2 dark:text-zinc-200";const o=document.createElement("div");o.className=i||"all-sublist-container";const d=document.createElement("div");try{d.id=Y(e.id)}catch(c){console.error("Error computing ID for noFolderList:",c),d.id=`fallback-nofolder-${e.id}`}d.className="no-folder-list container my-6 gap-x-8 gap-y-6 grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 w-full";let p=[];for(const c of e.children)if(c.children){const a=Z(c,t,"sublist-container container w-full flex-center flex-col gap-3","","sublist-title container flex-start w-full text-semibold text-zinc-600 dark:text-zinc-300 text-lg py-2");a&&p.push(a)}else if(c.url&&(!t||A(c.title,t)||A(c.url,t))){const k=K(c,t);d.appendChild(k)}return o.appendChild(E),o.appendChild(d),p.forEach(c=>{o.appendChild(c)}),s.appendChild(o),s}return null}function U(e,t){g.innerHTML="";let n=0,i=[];if(e&&e.length>0){const r=e[0];if(x&&x!==0&&x!=="all"){let o=function(p,c){if(p.id===c)return p;if(p.children)for(const a of p.children){const k=o(a,c);if(k)return k}return null};var s=o;const d=o(r,x);if(d){n=N(d,t);const p=document.createElement("h1");p.textContent=j(t,x,n),p.className="flex-start w-full font-semibold text-lg py-2 text-zinc-800 dark:text-zinc-50",g.appendChild(p);const c=document.createElement("div");if(c.className="no-folder-list container my-6 gap-x-8 gap-y-6 grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 w-full",c.id=`no-folder-list-${x}`,d.children){for(const a of d.children)if(!a.children&&a.url&&(!t||A(a.title,t)||A(a.url,t))){const b=K(a,t);c.appendChild(b)}}if(g.appendChild(c),d.children){for(const a of d.children)if(a.children){const k=Z(a,t);k&&g.appendChild(k)}}if(n===0){const a=document.createElement("p");a.textContent=t?`No bookmarks found matching "${t}"`:"No bookmarks found.",a.className="text-zinc-500 dark:text-zinc-400 mt-4",g.appendChild(a)}return}}(r.children||[]).forEach(function(o){if(o.children){const d=Z(o,t);if(d){i.push(d);const p=N(o,t);n+=p}}})}const l=document.createElement("h1");if(l.textContent=j(t,x,n),l.className="flex-start w-full font-semibold text-lg py-2 text-zinc-800 dark:text-zinc-50",g.appendChild(l),i.forEach(r=>{g.appendChild(r)}),n===0){const r=document.createElement("p");r.textContent=t?`No bookmarks found matching "${t}"`:"No bookmark folders found.",r.className="text-zinc-500 dark:text-zinc-400 mt-4",g.appendChild(r)}}});
