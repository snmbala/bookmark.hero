function X(){const m=document.documentElement,h=document.getElementById("settings-icon-svg");h&&(m.classList.contains("dark")?h.querySelectorAll("path").forEach(a=>{a.setAttribute("stroke","#a5b4fc")}):h.querySelectorAll("path").forEach(a=>{a.setAttribute("stroke","#4f46e5")}))}function de(){const m=document.querySelectorAll(".theme-toggle-btn");if(!m.length)return;const h=document.documentElement;function a(d){chrome?.storage?.sync?chrome.storage.sync.get(["appearanceMode"],u=>d(u.appearanceMode||"auto")):d(localStorage.getItem("appearanceMode")||"auto")}function x(d){chrome?.storage?.sync?chrome.storage.sync.set({appearanceMode:d}):localStorage.setItem("appearanceMode",d)}function E(d){m.forEach((u,$)=>{u.classList.remove("bg-indigo-50","border-2","border-indigo-400","text-indigo-700","bg-white","text-zinc-500","dark:bg-indigo-500/10","dark:border-indigo-400","dark:text-indigo-200","dark:bg-zinc-700","dark:text-zinc-300","rounded-l-md","rounded-r-md"),u.classList.add("bg-white","text-zinc-500","dark:bg-zinc-700","dark:text-zinc-300"),$===0&&u.classList.add("rounded-l-md"),$===m.length-1&&u.classList.add("rounded-r-md"),d==="auto"&&u.getAttribute("data-theme")==="auto"||d==="light"&&u.getAttribute("data-theme")==="light"||d==="dark"&&u.getAttribute("data-theme")==="dark"?(u.classList.remove("bg-white","text-zinc-500","dark:bg-zinc-700","dark:text-zinc-300"),u.classList.add("bg-indigo-50","border-2","border-indigo-400","text-indigo-700","dark:bg-indigo-500/10","dark:border-indigo-400","dark:text-indigo-200")):u.classList.remove("border-2","border-indigo-400","text-indigo-700","dark:bg-indigo-500/10","dark:border-indigo-400","dark:text-indigo-200")})}function y(d){d==="dark"?h.classList.add("dark"):d==="light"?h.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches?h.classList.add("dark"):h.classList.remove("dark"),X()}a(d=>{E(d),y(d)}),m.forEach(d=>{d.addEventListener("click",()=>{const u=d.getAttribute("data-theme");x(u),E(u),y(u)})}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",d=>{a(u=>{u==="auto"&&y("auto")})})}function oe(m,h,a){if(!m){console.error("URL is empty");return}const x=1024,E=683;chrome.windows.create({url:m,type:"popup",width:x,height:E,left:Math.round((screen.width-x)/2),top:Math.round((screen.height-E)/2)},function(y){y.tabs[0].id,chrome.tabs.onUpdated.addListener(function d(u,$){u===u&&$.status==="complete"&&(chrome.tabs.onUpdated.removeListener(d),setTimeout(function(){chrome.tabs.captureVisibleTab(y.id,{format:"png"},function(T){T?ue(T,100,function(w){fe(m,w),a&&typeof a=="function"&&a(m,w)}):console.error("Failed to capture screenshot for URL:",m),chrome.windows.remove(y.id)})},1e3))})})}function ue(m,h,a){const x=new Image;x.src=m,x.onload=function(){const E=document.createElement("canvas"),y=E.getContext("2d");E.width=1024,E.height=683,y.drawImage(x,0,0,E.width,E.height);let d=1;for(;;){const u=E.toDataURL("image/jpeg",d);if(u.length/1024<=h||d<=.1){a(u);break}else d-=.1}}}function fe(m,h){const a=m,x=h;chrome.storage.local.set({[a]:x},function(){chrome.runtime.lastError&&console.error(chrome.runtime.lastError.message)})}function le(m,h){const a=m;chrome.storage.local.get([a],function(x){if(chrome.runtime.lastError)h(`https://www.google.com/s2/favicons?domain=${m}`);else{const E=x[a];h(E||`https://www.google.com/s2/favicons?domain=${m}`)}})}chrome.bookmarks.getTree(function(m){const h=document.getElementById("folder-list"),a=document.getElementById("search-input"),x=document.getElementById("clear-search"),E=document.getElementById("search-icon"),y=document.getElementById("filter"),d=document.getElementById("folder-view"),u=document.getElementById("recents-view"),$=document.getElementById("recents-icon"),T=document.getElementById("settings-btn");let w=0,I=!0,z=[],D=[{label:"All",value:"all",level:0,id:0}];de(),document.addEventListener("DOMContentLoaded",X),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",X);let N=!1;const F=document.getElementById("settings-modal");T.addEventListener("click",function(e){e.stopPropagation(),F.classList.toggle("hidden"),N=!F.classList.contains("hidden")}),F.addEventListener("click",function(e){e.stopPropagation()}),document.addEventListener("click",function(){N&&!F.classList.contains("hidden")&&(F.classList.add("hidden"),N=!1)});function _(e,t=""){if(e.children){t=e.title;for(const i of e.children)_(i,t)}else z.push({bookmark:e,folder:t})}for(const e of m[0].children)_(e);let q=z.sort((e,t)=>{const i=e.bookmark.dateLastUsed||e.bookmark.dateAdded;return(t.bookmark.dateLastUsed||t.bookmark.dateAdded)-i});a.addEventListener("input",function(){if(a.value){x.classList.remove("hidden"),document.activeElement===a?E.src="assets/icons/search-blue.svg":E.src="assets/icons/search.svg";const e=a.value.trim().toLowerCase();I?S(e):A(m,e)}else x.classList.add("hidden"),E.src="assets/icons/search.svg",I?S(""):A(m,"")}),x.addEventListener("click",function(){a.value="",x.classList.add("hidden"),E.src="assets/icons/search.svg",I?S(""):A(m,"")}),document.addEventListener("keydown",function(e){e.key==="/"&&document.activeElement!==a&&(e.preventDefault(),a.focus()),e.key==="Escape"&&document.activeElement===a&&a.blur()});function Z(){I=!I,a.value="",x.classList.add("hidden"),E.src="assets/icons/search.svg",y.value="all",w=0,W();const e="",t=document.querySelectorAll(".folder-icon"),i=document.getElementById("settings-icon-svg");I?(t.forEach(n=>{n.style.fill="none",n.style.stroke="#a1a1aa"}),d.classList.remove("active"),d.classList.add("in-active"),$.style.fill="#4f46e5",$.style.stroke="#4f46e5",u.classList.add("active"),u.classList.remove("in-active"),i&&i.querySelectorAll("path").forEach(n=>{n.setAttribute("stroke","#4f46e5")}),S(e)):(t.forEach(n=>{n.style.fill="#4f46e5",n.style.stroke="#4f46e5"}),d.classList.add("active"),d.classList.remove("in-active"),$.style.stroke="#a1a1aa",$.style.fill="none",u.classList.remove("active"),u.classList.add("in-active"),i&&i.querySelectorAll("path").forEach(n=>{n.setAttribute("stroke","#a1a1aa")}),A(m,e))}function S(e){q=z.sort((o,l)=>{const g=o.bookmark.dateLastUsed||o.bookmark.dateAdded;return(l.bookmark.dateLastUsed||l.bookmark.dateAdded)-g});let t=q.filter(o=>{const l=!e||M(o.bookmark.title,e)||M(o.bookmark.url,e);if(w&&w!==0&&w!=="all"){const g=o.bookmark.parentId==w;return l&&g}return l});h.innerHTML="";const i=document.createElement("h1");i.textContent=K(e,w,t.length),i.className="flex-start w-full font-semibold text-lg py-2 text-zinc-800 dark:text-zinc-50";const n=document.createElement("div");n.className="w-fit",h.appendChild(n);const c=document.createElement("div");if(c.className="container mx-auto grid my-6 lg:grid-cols-4 md:grid-cols-3 sm:grid-cols-2 gap-8",n.appendChild(i),n.appendChild(c),t.forEach(o=>{if(!o.children){const l=G(o.bookmark,e);c.appendChild(l)}}),t.length===0){const o=document.createElement("p");o.textContent=e?`No bookmarks found matching "${e}"`:"No bookmarks found.",o.className="text-zinc-500 dark:text-zinc-400 mt-4",n.appendChild(o)}}function G(e,t){const i=document.createElement("div");i.className="relative card min-w-60 flex flex-col border-[1.5px] bg-white border-zinc-200; dark:border-zinc-700 hover:border-indigo-500 hover:shadow-md hover:shadow-indigo-100 dark:hover:shadow-indigo-700 rounded-md overflow-hidden";const n=document.createElement("button");n.className="absolute top-0 right-0 m-1 p-1 bg-zinc-500 hover:bg-zinc-600 dark:bg-zinc-700 dark:hover:bg-zinc-800 rounded-full border-none cursor-pointer close-button",n.addEventListener("click",function(b){b.stopPropagation(),ce(b,e)});const c=document.createElement("img");c.src="assets/icons/more.svg",c.alt="Close",c.className="h-4 w-4",n.appendChild(c),i.appendChild(n);const o=document.createElement("a");o.href=e.url,o.target="_blank",o.className="flex-center flex-col gap-3 card-thumbnail w-full h-40 border-b-[1.5px] bg-zinc-100 dark:bg-zinc-700 dark:border-zinc-600",le(e.url,function(b){const C=document.createElement("img");if(C.src=b,C.alt=e.url||"Bookmark thumbnail",o.appendChild(C),e.title,b.startsWith("https://www.google.com/s2/favicons?domain=")){const p=document.createElement("button");p.textContent="Capture Thumbnail",p.className="text-zinc-800 dark:text-zinc-200 border-zinc-300 dark:border-zinc-700 bg-white hover:bg-zinc-50 dark:bg-zinc-800 dark:hover:bg-zinc-900 font-semibold py-2 px-4 border shadow rounded-full",p.id="capture-"+e.url,p.addEventListener("click",function(U){U.preventDefault(),oe(e.url,e.title,function(J,V){C.src=V,p.parentNode&&p.parentNode.removeChild(p)})}),o.appendChild(p)}}),i.appendChild(o),o.addEventListener("click",function(b){const C=new Date().getTime();for(const p of z)if(p.bookmark.id===e.id){p.bookmark.dateLastUsed=C;break}});const l=document.createElement("div");l.className="flex-center h-24 flex-col bg-white dark:bg-zinc-800 px-2 py-4";const g=document.createElement("div");g.className="flex-start w-full h-5";const r=document.createElement("a");r.className="flex-start text-base font-medium text-zinc-800 dark:text-zinc-50 whitespace-nowrap overflow-hidden text-ellipsis",r.href=e.url,r.target="_blank",r.innerHTML=P(e.title||"Untitled",t),g.appendChild(r),r.addEventListener("click",function(b){const C=new Date().getTime();for(const p of z)if(p.bookmark.id===e.id){p.bookmark.dateLastUsed=C;break}}),l.appendChild(g),setTimeout(()=>{r.offsetWidth>216&&g.classList.add("text-scroll")},0);const v=document.createElement("div");v.className="flex-start w-full h-5 overflow-hidden";const k=document.createElement("p");k.className="flex-start text-zinc-800 dark:text-zinc-300 whitespace-nowrap",k.title=e.url;const f=new URL(e.url);let s=f.hostname.replace(/^www\./,"");const L=f.pathname;if(L&&L!=="/"?s=P(s,t)+`<span class="text-zinc-400 whitespace-nowrap">${P(L,t)}</span>`:s=P(s,t),k.innerHTML=s,v.appendChild(k),l.appendChild(v),I){let b="";const C=z.find(p=>p.bookmark.id===e.id);if(C&&C.folder)b=C.folder;else{const p=D.find(U=>U.value===e.parentId);p&&(b=p.label.replace(/^[-\s]+/,""))}if(b){const p=document.createElement("div");p.className="flex-start w-full mt-1";const U=document.createElement("span");U.textContent=b,U.className="flex-center w-fit h-5 px-2 py-0.5 rounded-md bg-zinc-200 dark:bg-zinc-700 dark:text-zinc-50 border border-zinc-300 dark:border-zinc-600 text-xs font-medium",p.appendChild(U),l.appendChild(p)}}return i.appendChild(l),i}u.addEventListener("click",Z),d.addEventListener("click",Z),y.addEventListener("change",function(e){w=e.target.value=="all"?0:e.target.value;const t=a.value.trim().toLowerCase();W(),I?S(t):A(m,t)});function M(e,t){return!e||!t?!1:t.toLowerCase().split(" ").every(n=>e.toLowerCase().includes(n))}function P(e,t){if(!t||!e)return e;const i=t.toLowerCase().split(/\s+/).filter(c=>c.length>0);let n=e;return i.forEach(c=>{const o=new RegExp(`(${c})`,"gi");n=n.replace(o,'<mark class="bg-yellow-200 dark:bg-yellow-600 dark:text-zinc-100 px-0.5 rounded-sm">$1</mark>')}),n}function K(e,t,i){const n=e&&e.trim().length>0,c=t&&t!==0&&t!=="all";let o="",l="";if(c){const g=D.find(r=>r.value==t);g&&(o=g.label.replace(/^[\s\-]*/,""),l=o.includes("- ")?o.replace(/\s*-\s*/g," > "):o)}return n&&c?i===0?`No results for "${e}" in ${l}`:`Results for "${e}" in ${l} (${i})`:n?i===0?`No results for "${e}"`:`Results for "${e}" (${i})`:c?`Folder: ${l} (${i})`:I?`Recent Bookmarks (${i})`:`Bookmarks (${i})`}function me(e,t){}let B=null,R=null;function ce(e,t){B&&B.remove(),R=t;const i=document.getElementById("folder-dropdown");if(i&&i.children.length===0&&D.slice(1).forEach(function(g){const r=document.createElement("option");r.value=g.value,r.textContent=g.label,r.selected=g.value===R.parentId,i.appendChild(r)}),B&&B.previousElementSibling===e.target){B.remove(),B=null;return}if(B){l();return}const n=document.createElement("div");n.className="absolute z-10 flex flex-col bg-zinc-800 w-44 h-32 rounded shadow-md text-zinc-100 hover:text-zinc-50 text-sm font-light flex-center flex-col";function c(g,r,v,k){const f=document.createElement("div");f.className="flex-start w-full h-9 px-3 py-1.5 hover:bg-zinc-700 active:bg-zinc-700";const s=document.createElement("img");s.src=r,s.alt=g,s.className="w-4 h-4 mr-3",f.appendChild(s);const L=document.createElement("button");return L.textContent=g,L.className=v||"flex-start text-left",L.addEventListener("click",k),f.appendChild(L),f}le(t.url,function(g){const r=g.startsWith("https://www.google.com/s2/favicons?domain=")?"Capture Thumbnail":"Refresh Thumbnail",v=c(r,"assets/icons/camera.svg",null,function(s){s.preventDefault(),oe(t.url,t.title,function(L,b){document.querySelectorAll(".card").forEach(p=>{if(p.querySelector('a[href="'+t.url+'"]')){const J=p.querySelector('img[alt="'+t.url+'"]');J&&(J.src=b);const V=p.querySelector("#capture-"+t.url);V&&V.parentNode&&V.parentNode.removeChild(V)}})}),l()});n.appendChild(v);const k=c("Edit","assets/icons/edit.svg",null,function(s){l(),s.preventDefault(),se(t)});n.appendChild(k);const f=c("Delete","assets/icons/trash.svg","flex-grow text-left",function(s){s.preventDefault(),confirm("Are you sure you want to delete this bookmark?")&&re(t),l()});n.appendChild(f)});const o=e.target.getBoundingClientRect();n.style.top=`${o.bottom+window.scrollY+4}px`,n.style.right=`${window.innerWidth-o.right-4}px`,document.body.appendChild(n),B=n;function l(){B&&(B.remove(),B=null,document.removeEventListener("click",l))}document.addEventListener("click",l),e.stopPropagation()}function se(e){const t=document.getElementById("edit-modal"),i=document.getElementById("edit-title"),n=document.getElementById("edit-url");i.value=e.title||"",n.value=e.url||"",t.classList.remove("hidden")}function O(){document.getElementById("edit-modal").classList.add("hidden")}function re(e){const t=e.url;chrome.bookmarks.remove(e.id,function(){console.log(`Deleted bookmark: ${e.title}`),chrome.storage.local.remove([t],function(){z=z.filter(n=>n.bookmark.id!==e.id),q=z.sort((n,c)=>{const o=n.bookmark.dateLastUsed||n.bookmark.dateAdded;return(c.bookmark.dateLastUsed||c.bookmark.dateAdded)-o});const i=a.value.trim().toLowerCase();I?S(i):chrome.bookmarks.getTree(function(n){h.innerHTML="",A(n,i)})})})}function ee(e,t=0,i=""){e&&e.length>0&&e.forEach(function(n){n.children&&(n.title&&D.push({label:`${t>0?"-".repeat(t-1)+" ":""}`+n.title,value:n.id,level:t,id:i+"-"+n.id+"-"}),ee(n.children,t+1,i+"-"+n.id))})}ee(m),D.forEach(function(e){const t=document.createElement("option");t.value=e.value,t.textContent=e.label,t.className="flex-center flex-col bg-zinc-100 w-44 h-32 rounded shadow-md text-zinc-800 text-sm font-normal cursor-pointer py-5",y.appendChild(t)});function W(){const e=document.getElementById("filter"),t=document.getElementById("filter-dropdown-arrow"),i=document.getElementById("filter-clear");e&&t&&i&&(e.value&&e.value!=="all"?(t.classList.add("hidden"),i.classList.remove("hidden")):(t.classList.remove("hidden"),i.classList.add("hidden")))}setTimeout(()=>{const e=document.getElementById("filter"),t=document.getElementById("filter-clear");W(),t&&t.addEventListener("click",function(){if(e){e.value="all",w=0,W();const i=a.value.trim().toLowerCase();I?S(i):A(m,i)}})},100),S("");const te=document.getElementById("cancel-edit"),ne=document.getElementById("save-edit"),j=document.getElementById("edit-modal");te&&te.addEventListener("click",function(){O()}),ne&&ne.addEventListener("click",function(){if(R){const e=document.getElementById("edit-title"),t=document.getElementById("edit-url"),i=document.getElementById("folder-dropdown"),n=e.value.trim(),c=t.value.trim(),o=i.value;n&&c&&chrome.bookmarks.update(R.id,{title:n,url:c},function(){o!==R.parentId?chrome.bookmarks.move(R.id,{parentId:o},function(){O(),ie()}):(O(),ie())})}}),j&&j.addEventListener("click",function(e){e.target===j&&O()});function ie(){const e=a.value.trim().toLowerCase();chrome.bookmarks.getTree(function(t){z=[];for(const i of t[0].children)_(i);q=z.sort((i,n)=>{const c=i.bookmark.dateLastUsed||i.bookmark.dateAdded;return(n.bookmark.dateLastUsed||n.bookmark.dateAdded)-c}),I?S(e):A(t,e)})}function Q(e){const t=D.find(i=>i.value===e);return t?t.id:(console.warn(`No filter option found for bookmark ID: ${e}`),`fallback-${e}`)}function H(e,t){let i=0;if(e.children)for(const n of e.children)i+=H(n,t);else e.url&&(!t||M(e.title,t)||M(e.url,t))&&i++;return i}function ae(e,t,i){const n=e.title,c=H(e,t),o=t&&t.trim().length>0,l=i&&i!==0&&i!=="all";return c===0?null:o&&l?`${n} - Results for "${t}" (${c})`:o?`${n} - Results for "${t}" (${c})`:l?`${n} (${c})`:`${n} (${c})`}function Y(e,t,i,n,c){const o=document.createElement("div");try{o.id=Q(e.id)}catch(l){console.error("Error computing ID for bookmark:",e.title,l),o.id=`fallback-${e.id}`}if(o.className=i||"flex-center flex-col m-auto gap-4",e.children&&e.children.length>0){const l=ae(e,t,w);if(l===null)return null;const g=document.createElement("h2");try{g.id=Q(e.id)}catch(f){console.error("Error computing ID for folder title:",e.title,f),g.id=`fallback-title-${e.id}`}g.textContent=l||"Untitled",g.className=c||"container flex-start w-full text-semibold text-zinc-600 text-lg py-2 dark:text-zinc-200";const r=document.createElement("div");r.className=n||"all-sublist-container";const v=document.createElement("div");try{v.id=Q(e.id)}catch(f){console.error("Error computing ID for noFolderList:",f),v.id=`fallback-nofolder-${e.id}`}v.className="no-folder-list container my-6 gap-x-8 gap-y-6 grid lg:grid-cols-4 md:grid-cols-3 sm:grid-cols-2 w-full";let k=[];for(const f of e.children)if(f.children){const s=Y(f,t,"sublist-container container w-full flex-center flex-col gap-3","","sublist-title container flex-start w-full text-semibold text-zinc-600 dark:text-zinc-300 text-lg py-2");s&&k.push(s)}else if(f.url&&(!t||M(f.title,t)||M(f.url,t))){const L=G(f,t);v.appendChild(L)}return r.appendChild(g),r.appendChild(v),k.forEach(f=>{r.appendChild(f)}),o.appendChild(r),o}return null}function A(e,t){h.innerHTML="";let i=0,n=[];if(e&&e.length>0){const l=e[0];if(w&&w!==0&&w!=="all"){let r=function(k,f){if(k.id===f)return k;if(k.children)for(const s of k.children){const L=r(s,f);if(L)return L}return null};var o=r;const v=r(l,w);if(v){i=H(v,t);const k=document.createElement("h1");k.textContent=K(t,w,i),k.className="flex-start w-full font-semibold text-lg py-2 text-zinc-800 dark:text-zinc-50",h.appendChild(k);const f=document.createElement("div");if(f.className="no-folder-list container my-6 gap-x-8 gap-y-6 grid lg:grid-cols-4 md:grid-cols-3 sm:grid-cols-2 w-full",f.id=`no-folder-list-${w}`,v.children){for(const s of v.children)if(!s.children&&s.url&&(!t||M(s.title,t)||M(s.url,t))){const b=G(s,t);f.appendChild(b)}}if(h.appendChild(f),v.children){for(const s of v.children)if(s.children){const L=Y(s,t);L&&h.appendChild(L)}}if(i===0){const s=document.createElement("p");s.textContent=t?`No bookmarks found matching "${t}"`:"No bookmarks found.",s.className="text-zinc-500 dark:text-zinc-400 mt-4",h.appendChild(s)}return}}(l.children||[]).forEach(function(r){if(r.children){const v=Y(r,t);if(v){n.push(v);const k=H(r,t);i+=k}}})}const c=document.createElement("h1");if(c.textContent=K(t,w,i),c.className="flex-start w-full font-semibold text-lg py-2 text-zinc-800 dark:text-zinc-50",h.appendChild(c),n.forEach(l=>{h.appendChild(l)}),i===0){const l=document.createElement("p");l.textContent=t?`No bookmarks found matching "${t}"`:"No bookmark folders found.",l.className="text-zinc-500 dark:text-zinc-400 mt-4",h.appendChild(l)}}});
