function ie(){const t=document.documentElement,o=document.getElementById("settings-icon-svg");o&&(t.classList.contains("dark")?o.querySelectorAll("path").forEach(d=>{d.setAttribute("stroke","#a5b4fc")}):o.querySelectorAll("path").forEach(d=>{d.setAttribute("stroke","#4f46e5")}))}function Le(){const t=document.querySelectorAll(".theme-toggle-btn");if(!t.length)return;const o=document.documentElement;function d(s){chrome?.storage?.sync?chrome.storage.sync.get(["appearanceMode"],u=>s(u.appearanceMode||"auto")):s(localStorage.getItem("appearanceMode")||"auto")}function i(s){chrome?.storage?.sync?chrome.storage.sync.set({appearanceMode:s}):localStorage.setItem("appearanceMode",s)}function c(s){t.forEach((u,x)=>{u.classList.remove("bg-indigo-50","border-2","border-indigo-400","text-indigo-700","bg-white","text-zinc-500","dark:bg-indigo-500/10","dark:border-indigo-400","dark:text-indigo-200","dark:bg-zinc-700","dark:text-zinc-300","rounded-l-md","rounded-r-md"),u.classList.add("bg-white","text-zinc-500","dark:bg-zinc-700","dark:text-zinc-300"),x===0&&u.classList.add("rounded-l-md"),x===t.length-1&&u.classList.add("rounded-r-md"),s==="auto"&&u.getAttribute("data-theme")==="auto"||s==="light"&&u.getAttribute("data-theme")==="light"||s==="dark"&&u.getAttribute("data-theme")==="dark"?(u.classList.remove("bg-white","text-zinc-500","dark:bg-zinc-700","dark:text-zinc-300"),u.classList.add("bg-indigo-50","border-2","border-indigo-400","text-indigo-700","dark:bg-indigo-500/10","dark:border-indigo-400","dark:text-indigo-200")):u.classList.remove("border-2","border-indigo-400","text-indigo-700","dark:bg-indigo-500/10","dark:border-indigo-400","dark:text-indigo-200")})}function a(s){s==="dark"?o.classList.add("dark"):s==="light"?o.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches?o.classList.add("dark"):o.classList.remove("dark"),ie()}d(s=>{c(s),a(s)}),t.forEach(s=>{s.addEventListener("click",()=>{const u=s.getAttribute("data-theme");i(u),c(u),a(u)})}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",s=>{d(u=>{u==="auto"&&a("auto")})})}function le(t,o,d){if(!t){console.error("URL is empty");return}const i=1024,c=683;chrome.windows.create({url:t,type:"popup",width:i,height:c,left:Math.round((screen.width-i)/2),top:Math.round((screen.height-c)/2)},function(a){a.tabs[0].id,chrome.tabs.onUpdated.addListener(function s(u,x){u===u&&x.status==="complete"&&(chrome.tabs.onUpdated.removeListener(s),setTimeout(function(){chrome.tabs.captureVisibleTab(a.id,{format:"png"},function(A){A?Ie(A,100,function(k){Be(t,k),d&&typeof d=="function"&&d(t,k)}):console.error("Failed to capture screenshot for URL:",t),chrome.windows.remove(a.id)})},1e3))})})}function Ie(t,o,d){const i=new Image;i.src=t,i.onload=function(){const c=document.createElement("canvas"),a=c.getContext("2d");c.width=1024,c.height=683,a.drawImage(i,0,0,c.width,c.height);let s=1;for(;;){const u=c.toDataURL("image/jpeg",s);if(u.length/1024<=o||s<=.1){d(u);break}else s-=.1}}}function Be(t,o){const d=t,i=o;chrome.storage.local.set({[d]:i},function(){chrome.runtime.lastError&&console.error(chrome.runtime.lastError.message)})}function pe(t,o){const d=t;chrome.storage.local.get([d],function(i){if(chrome.runtime.lastError)o(`https://www.google.com/s2/favicons?domain=${t}`);else{const c=i[d];o(c||`https://www.google.com/s2/favicons?domain=${t}`)}})}chrome.bookmarks.getTree(function(t){const o=document.getElementById("folder-list"),d=document.getElementById("search-input"),i=document.getElementById("clear-search"),c=document.getElementById("search-icon"),a=document.getElementById("filter"),s=document.getElementById("folder-view"),u=document.getElementById("recents-view"),x=document.getElementById("recents-icon"),A=document.getElementById("settings-btn");let k=0,B=!0,v=[],z=[{label:"All",value:"all",level:0,id:0}],P={data:null,timestamp:0};const Ee=5e3;function ye(e,n){let r;return function(...f){const h=()=>{clearTimeout(r),e(...f)};clearTimeout(r),r=setTimeout(h,n)}}function se(){const e=Date.now();return P.data&&e-P.timestamp<Ee?Promise.resolve(P.data):new Promise(n=>{chrome.bookmarks.getTree(r=>{P.data=r,P.timestamp=e,n(r)})})}Le(),document.addEventListener("DOMContentLoaded",ie),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",ie);let K=!1;const O=document.getElementById("settings-modal");A.addEventListener("click",function(e){e.stopPropagation(),O.classList.toggle("hidden"),K=!O.classList.contains("hidden"),K&&setTimeout(()=>{const n=document.querySelector('button[data-theme="auto"]');n&&(n.focus(),console.log("🎯 Focused Auto theme button in settings modal"))},100)}),O.addEventListener("click",function(e){e.stopPropagation()}),document.addEventListener("click",function(){K&&!O.classList.contains("hidden")&&(O.classList.add("hidden"),K=!1)});function Z(e,n=""){if(e.children){n=e.title;for(const r of e.children)Z(r,n)}else v.push({bookmark:e,folder:n})}for(const e of t[0].children)Z(e);let _=v.sort((e,n)=>{const r=e.bookmark.dateLastUsed||e.bookmark.dateAdded;return(n.bookmark.dateLastUsed||n.bookmark.dateAdded)-r});const ve=ye(function(e){B?T(e):F(t,e)},300);d.addEventListener("input",function(){if(d.value){i.classList.remove("hidden"),document.activeElement===d?c.src="assets/icons/search-blue.svg":c.src="assets/icons/search.svg";const e=d.value.trim().toLowerCase();ve(e)}else i.classList.add("hidden"),c.src="assets/icons/search.svg",B?T(""):F(t,"")}),i.addEventListener("click",function(){d.value="",i.classList.add("hidden"),c.src="assets/icons/search.svg",B?T(""):F(t,"")});function ce(){B=!B,d.value="",i.classList.add("hidden"),c.src="assets/icons/search.svg",a.value="all",k=0,j();const e="",n=document.querySelectorAll(".folder-icon"),r=document.getElementById("settings-icon-svg");B?(n.forEach(l=>{l.style.fill="none",l.style.stroke="#a1a1aa"}),s.classList.remove("active"),s.classList.add("in-active"),x.style.fill="#4f46e5",x.style.stroke="#4f46e5",u.classList.add("active"),u.classList.remove("in-active"),r&&r.querySelectorAll("path").forEach(l=>{l.setAttribute("stroke","#4f46e5")}),T(e)):(n.forEach(l=>{l.style.fill="#4f46e5",l.style.stroke="#4f46e5"}),s.classList.add("active"),s.classList.remove("in-active"),x.style.stroke="#a1a1aa",x.style.fill="none",u.classList.remove("active"),u.classList.add("in-active"),r&&r.querySelectorAll("path").forEach(l=>{l.setAttribute("stroke","#a1a1aa")}),F(t,e))}function T(e){_=v.sort((m,p)=>{const y=m.bookmark.dateLastUsed||m.bookmark.dateAdded;return(p.bookmark.dateLastUsed||p.bookmark.dateAdded)-y});let n=_.filter(m=>{const p=!e||U(m.bookmark.title,e)||U(m.bookmark.url,e);if(k&&k!==0&&k!=="all"){const y=m.bookmark.parentId==k;return p&&y}return p});o.innerHTML="",document.querySelectorAll("[data-scroll-handler]").forEach(m=>{m.scrollHandler&&window.removeEventListener("scroll",m.scrollHandler)});const l=document.createElement("h1");l.textContent=ee(e,k,n.length),l.className="flex-start w-full font-semibold text-lg py-2 text-zinc-800 dark:text-zinc-50";const f=document.createElement("div");f.className="w-fit",o.appendChild(f);const h=document.createElement("div");h.className="container mx-auto grid my-6 grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8",f.appendChild(l),f.appendChild(h);const g=100;let E=0,w=!1;h.setAttribute("data-scroll-handler","true");function b(){if(w)return;w=!0;const m=E*g,p=Math.min(m+g,n.length),y=document.createDocumentFragment();for(let M=m;M<p;M++){const q=n[M];if(!q.children){const $=J(q.bookmark,e,q.folder);y.appendChild($)}}h.appendChild(y),E++,w=!1,window.updateBookmarkCards&&window.updateBookmarkCards()}function C(){const m=()=>{window.innerHeight+window.scrollY>=document.documentElement.scrollHeight-200&&E*g<n.length&&!w&&b()};window.addEventListener("scroll",m),h.scrollHandler=m}if(n.length>0&&(b(),n.length>g&&C()),n.length===0){const m=document.createElement("p");m.textContent=e?`No bookmarks found matching "${e}"`:"No bookmarks found.",m.className="text-zinc-500 dark:text-zinc-400 mt-4",f.appendChild(m)}}function J(e,n,r=null){const l=document.createElement("div");l.className="relative card min-w-60 flex flex-col border-[1.5px] bg-white border-zinc-200; dark:border-zinc-700 hover:border-indigo-500 hover:shadow-md hover:shadow-indigo-100 dark:hover:shadow-indigo-700 rounded-md overflow-hidden",l.setAttribute("tabindex","0"),l.setAttribute("data-parent-id",e.parentId||"1"),l.setAttribute("data-bookmark-id",e.id),l.setAttribute("data-bookmark-url",e.url),l.addEventListener("keydown",function(I){if(document.activeElement===l)if(I.key==="Enter")I.preventDefault(),e.url&&window.open(e.url,"_blank");else if(I.key.toLowerCase()==="m"){I.preventDefault();const S=l.querySelector(".close-button");S&&(S.click(),setTimeout(()=>{l.focus()},200))}else["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(I.key)});const f=document.createElement("button");f.className="absolute top-0 right-0 m-1 p-1 bg-zinc-500 hover:bg-zinc-600 dark:bg-zinc-700 dark:hover:bg-zinc-800 rounded-full border-none cursor-pointer close-button",f.setAttribute("aria-label","More actions for "+e.title),f.addEventListener("click",function(I){I.stopPropagation(),ae(I,e)});const h=document.createElement("img");h.src="assets/icons/more.svg",h.alt="Close",h.className="h-4 w-4",f.appendChild(h),l.appendChild(f);const g=document.createElement("a");g.href=e.url,g.target="_blank",g.className="flex-center flex-col gap-3 card-thumbnail w-full h-40 border-b-[1.5px] bg-zinc-100 dark:bg-zinc-700 dark:border-zinc-600",pe(e.url,function(I){const S=document.createElement("img");if(S.src=I,S.alt=e.url||"Bookmark thumbnail",g.appendChild(S),e.title,I.startsWith("https://www.google.com/s2/favicons?domain=")){const L=document.createElement("button");L.textContent="Capture Thumbnail",L.className="text-zinc-800 dark:text-zinc-200 border-zinc-300 dark:border-zinc-700 bg-white hover:bg-zinc-50 dark:bg-zinc-800 dark:hover:bg-zinc-900 font-semibold py-2 px-4 border shadow rounded-full",L.id="capture-"+e.url,L.addEventListener("click",function(R){R.preventDefault(),le(e.url,e.title,function(Ve,Ce){S.src=Ce,L.parentNode&&L.parentNode.removeChild(L)})}),g.appendChild(L)}}),l.appendChild(g),g.addEventListener("click",function(I){const S=new Date().getTime();for(const L of v)if(L.bookmark.id===e.id){L.bookmark.dateLastUsed=S;break}});const E=document.createElement("div");E.className="flex-center h-24 flex-col bg-white dark:bg-zinc-800 px-2 py-4";const w=document.createElement("div");w.className="flex-start w-full h-5";const b=document.createElement("a");b.className="flex-start text-base font-medium text-zinc-800 dark:text-zinc-50 whitespace-nowrap overflow-hidden text-ellipsis",b.href=e.url,b.target="_blank",b.innerHTML=G(e.title||"Untitled",n),w.appendChild(b),b.addEventListener("click",function(I){const S=new Date().getTime();for(const L of v)if(L.bookmark.id===e.id){L.bookmark.dateLastUsed=S;break}}),E.appendChild(w),setTimeout(()=>{b.offsetWidth>216&&w.classList.add("text-scroll")},0);const C=document.createElement("div");C.className="flex-start w-full h-5 overflow-hidden";const m=document.createElement("p");m.className="flex-start text-zinc-800 dark:text-zinc-300 whitespace-nowrap",m.title=e.url;const p=new URL(e.url);let y=p.hostname.replace(/^www\./,"");const M=p.pathname;if(M&&M!=="/"?y=G(y,n)+`<span class="text-zinc-400 whitespace-nowrap">${G(M,n)}</span>`:y=G(y,n),m.innerHTML=y,C.appendChild(m),E.appendChild(C),B){let I="";const S=v.find(L=>L.bookmark.id===e.id);if(S&&S.folder)I=S.folder;else{const L=z.find(R=>R.value===e.parentId);L&&(I=L.label.replace(/^[-\s]+/,""))}if(I){const L=document.createElement("div");L.className="flex-start w-full mt-1";const R=document.createElement("span");R.textContent=I,R.className="flex-center w-fit h-5 px-2 py-0.5 rounded-md bg-zinc-200 dark:bg-zinc-700 dark:text-zinc-50 border border-zinc-300 dark:border-zinc-600 text-xs font-medium",L.appendChild(R),E.appendChild(L)}}l.appendChild(E);const q=e.title||"Untitled";let $=q;r&&r.trim()&&($=`${r} - ${q}`),l.setAttribute("aria-label",$),l.setAttribute("role","link"),l.setAttribute("aria-describedby",`bookmark-url-${e.id}`);const W=document.createElement("span");return W.id=`bookmark-url-${e.id}`,W.className="sr-only",W.textContent=`URL: ${e.url}`,l.appendChild(W),l}u.addEventListener("click",ce),s.addEventListener("click",ce),a.addEventListener("change",function(e){k=e.target.value=="all"?0:e.target.value;const n=d.value.trim().toLowerCase();j(),B?T(n):F(t,n)});function U(e,n){return!e||!n?!1:n.toLowerCase().split(" ").every(l=>e.toLowerCase().includes(l))}function G(e,n){if(!n||!e)return e;const r=n.toLowerCase().split(/\s+/).filter(f=>f.length>0);let l=e;return r.forEach(f=>{const h=new RegExp(`(${f})`,"gi");l=l.replace(h,'<mark class="bg-yellow-200 dark:bg-yellow-600 dark:text-zinc-100 px-0.5 rounded-sm">$1</mark>')}),l}function ee(e,n,r){const l=e&&e.trim().length>0,f=n&&n!==0&&n!=="all";let h="",g="";if(f){const E=z.find(w=>w.value==n);E&&(h=E.label.replace(/^[\s\-]*/,""),g=h.includes("- ")?h.replace(/\s*-\s*/g," > "):h)}return l&&f?r===0?`No results for "${e}" in ${g}`:`Results for "${e}" in ${g} (${r})`:l?r===0?`No results for "${e}"`:`Results for "${e}" (${r})`:f?`Folder: ${g} (${r})`:B?`Recent Bookmarks (${r})`:`Bookmarks (${r})`}function Pe(e,n){}let D=null,V=null;function ae(e,n){D&&D.remove(),V=n;const r=document.getElementById("folder-dropdown");if(r&&r.children.length===0&&z.slice(1).forEach(function(E){const w=document.createElement("option");w.value=E.value,w.textContent=E.label,w.selected=E.value===V.parentId,r.appendChild(w)}),D&&D.previousElementSibling===e.target){D.remove(),D=null;return}if(D){g();return}const l=document.createElement("div");l.className="absolute z-10 flex flex-col bg-zinc-800 w-44 h-32 rounded shadow-md text-zinc-100 hover:text-zinc-50 text-sm font-light flex-center flex-col";function f(E,w,b,C){const m=document.createElement("div");m.className="flex-start w-full h-9 px-3 py-1.5 hover:bg-zinc-700 active:bg-zinc-700";const p=document.createElement("img");p.src=w,p.alt=E,p.className="w-4 h-4 mr-3",m.appendChild(p);const y=document.createElement("button");return y.textContent=E,y.className=b||"flex-start text-left",y.addEventListener("click",C),m.appendChild(y),m}pe(n.url,function(E){const w=E.startsWith("https://www.google.com/s2/favicons?domain=")?"Capture Thumbnail":"Recapture",b=f(w,"assets/icons/camera.svg",null,function(p){p.preventDefault(),le(n.url,n.title,function(y,M){document.querySelectorAll(".card").forEach($=>{if($.querySelector('a[href="'+n.url+'"]')){const I=$.querySelector('img[alt="'+n.url+'"]');I&&(I.src=M);const S=$.querySelector("#capture-"+n.url);S&&S.parentNode&&S.parentNode.removeChild(S)}})}),g()});l.appendChild(b);const C=f("Edit","assets/icons/edit.svg",null,function(p){g(),p.preventDefault(),de(n)});l.appendChild(C);const m=f("Delete","assets/icons/trash.svg","flex-grow text-left",function(p){p.preventDefault(),confirm("Are you sure you want to delete this bookmark?")&&ue(n),g()});l.appendChild(m)});const h=e.target.getBoundingClientRect();l.style.top=`${h.bottom+window.scrollY+4}px`,l.style.right=`${window.innerWidth-h.right-4}px`,document.body.appendChild(l),D=l;function g(){D&&(D.remove(),D=null,document.removeEventListener("click",g))}document.addEventListener("click",g),e.stopPropagation()}window.showPopupMenu=ae,window.openEditModal=de,window.closeEditModal=H,window.deleteBookmark=ue,window.captureScreenshot=le,window.getBookmarkFromCard=function(e){const n=e.querySelector("a");if(!n||!n.href)return null;let r="";const l=e.querySelector("h3");l?r=l.textContent.trim():r=e.getAttribute("aria-label")||"";const f=e.getAttribute("data-parent-id"),h=e.getAttribute("data-bookmark-id"),g=e.getAttribute("data-bookmark-url");return console.log("🔍 Extracting bookmark data from card:"),console.log("  ID:",h),console.log("  Title:",r),console.log("  URL:",g||n.href),console.log("  Parent ID:",f),{id:h,title:r,url:g||n.href,parentId:f||"1"}};function de(e){const n=document.getElementById("edit-modal"),r=document.getElementById("edit-title"),l=document.getElementById("edit-url"),f=document.getElementById("folder-dropdown");r.value=e.title||"",l.value=e.url||"",f&&f.children.length===0&&(console.log("📁 Populating folder dropdown..."),z.slice(1).forEach(function(h){const g=document.createElement("option");g.value=h.value,g.textContent=h.label,f.appendChild(g)})),f&&e.parentId&&(console.log("📂 Setting selected folder to:",e.parentId),f.value=e.parentId,f.value!==e.parentId&&console.log("⚠️ Warning: Parent folder not found in dropdown options")),window.currentBookmarkNode=e,window.lastFocusedElement||(window.lastFocusedElement=document.activeElement),n.classList.remove("hidden"),setTimeout(()=>{const h=document.getElementById("edit-title");h&&(h.focus(),h.select(),console.log("🎯 Focused title input in edit modal"))},100)}function H(){document.getElementById("edit-modal").classList.add("hidden"),window.lastFocusedElement&&document.contains(window.lastFocusedElement)?setTimeout(()=>{window.lastFocusedElement.focus(),console.log("🎯 Restored focus to previous element"),window.lastFocusedElement=null},100):setTimeout(()=>{const n=document.querySelector(".card");n&&(n.focus(),console.log("🎯 Focused first bookmark card as fallback")),window.lastFocusedElement=null},100)}function ue(e){const n=e.url;chrome.bookmarks.remove(e.id,function(){console.log(`Deleted bookmark: ${e.title}`),chrome.storage.local.remove([n],function(){v=v.filter(l=>l.bookmark.id!==e.id),_=v.sort((l,f)=>{const h=l.bookmark.dateLastUsed||l.bookmark.dateAdded;return(f.bookmark.dateLastUsed||f.bookmark.dateAdded)-h});const r=d.value.trim().toLowerCase();B?T(r):se().then(function(l){o.innerHTML="",F(l,r)})})})}function fe(e,n=0,r=""){e&&e.length>0&&e.forEach(function(l){l.children?(l.title&&z.push({label:`${n>0?"-".repeat(n-1)+" ":""}`+l.title,value:l.id,level:n,id:r+"-"+l.id+"-"}),fe(l.children,n+1,r+"-"+l.id)):l.parentId&&!z.find(f=>f.value===l.parentId)&&z.push({label:`Unknown Folder (${l.parentId})`,value:l.parentId,level:0,id:`unknown-${l.parentId}`})})}fe(t),z.forEach(function(e){const n=document.createElement("option");n.value=e.value,n.textContent=e.label,n.className="flex-center flex-col bg-zinc-100 w-44 h-32 rounded shadow-md text-zinc-800 text-sm font-normal cursor-pointer py-5",a.appendChild(n)});function j(){const e=document.getElementById("filter"),n=document.getElementById("filter-dropdown-arrow"),r=document.getElementById("filter-clear");e&&n&&r&&(e.value&&e.value!=="all"?(n.classList.add("hidden"),r.classList.remove("hidden")):(n.classList.remove("hidden"),r.classList.add("hidden")))}setTimeout(()=>{const e=document.getElementById("filter"),n=document.getElementById("filter-clear");j(),n&&n.addEventListener("click",function(){if(e){e.value="all",k=0,j();const r=d.value.trim().toLowerCase();B?T(r):F(t,r)}})},100),T("");const me=document.getElementById("cancel-edit"),ge=document.getElementById("save-edit"),te=document.getElementById("edit-modal");me&&me.addEventListener("click",function(){H()}),ge&&ge.addEventListener("click",function(){if(V){const e=document.getElementById("edit-title"),n=document.getElementById("edit-url"),r=document.getElementById("folder-dropdown"),l=e.value.trim(),f=n.value.trim(),h=r.value;l&&f&&chrome.bookmarks.update(V.id,{title:l,url:f},function(){h!==V.parentId?chrome.bookmarks.move(V.id,{parentId:h},function(){H(),he()}):(H(),he())})}}),te&&te.addEventListener("click",function(e){e.target===te&&H()});function he(){const e=d.value.trim().toLowerCase();P={data:null,timestamp:0},se().then(function(n){v=[];for(const r of n[0].children)Z(r);_=v.sort((r,l)=>{const f=r.bookmark.dateLastUsed||r.bookmark.dateAdded;return(l.bookmark.dateLastUsed||l.bookmark.dateAdded)-f}),B?T(e):F(n,e)})}function ne(e){const n=z.find(r=>r.value===e);return n?n.id:`fallback-${e}`}function Y(e,n){let r=0;if(e.children)for(const l of e.children)r+=Y(l,n);else e.url&&(!n||U(e.title,n)||U(e.url,n))&&r++;return r}function xe(e,n,r){const l=e.title,f=Y(e,n),h=n&&n.trim().length>0,g=r&&r!==0&&r!=="all";return f===0?null:h&&g?`${l} - Results for "${n}" (${f})`:h?`${l} - Results for "${n}" (${f})`:g?`${l} (${f})`:`${l} (${f})`}function oe(e,n,r,l,f){const h=document.createElement("div");try{h.id=ne(e.id)}catch(g){console.error("Error computing ID for bookmark:",e.title,g),h.id=`fallback-${e.id}`}if(h.className=r||"flex-center flex-col m-auto gap-4",e.children&&e.children.length>0){const g=xe(e,n,k);if(g===null)return null;const E=document.createElement("h2");try{E.id=ne(e.id)}catch(m){console.error("Error computing ID for folder title:",e.title,m),E.id=`fallback-title-${e.id}`}E.textContent=g||"Untitled",E.className=f||"container flex-start w-full text-semibold text-zinc-600 text-lg py-2 dark:text-zinc-200";const w=document.createElement("div");w.className=l||"all-sublist-container";const b=document.createElement("div");try{b.id=ne(e.id)}catch(m){console.error("Error computing ID for noFolderList:",m),b.id=`fallback-nofolder-${e.id}`}b.className="no-folder-list container my-6 gap-x-8 gap-y-6 grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 w-full";let C=[];for(const m of e.children)if(m.children){const p=oe(m,n,"sublist-container container w-full flex-center flex-col gap-3","","sublist-title container flex-start w-full text-semibold text-zinc-600 dark:text-zinc-300 text-lg py-2");p&&C.push(p)}else if(m.url&&(!n||U(m.title,n)||U(m.url,n))){const y=J(m,n,e.title);b.appendChild(y)}return w.appendChild(E),w.appendChild(b),C.forEach(m=>{w.appendChild(m)}),h.appendChild(w),h}return null}function F(e,n){o.innerHTML="";let r=0,l=[];if(e&&e.length>0){const g=e[0];if(k&&k!==0&&k!=="all"){let w=function(C,m){if(C.id===m)return C;if(C.children)for(const p of C.children){const y=w(p,m);if(y)return y}return null};var h=w;const b=w(g,k);if(b){r=Y(b,n);const C=document.createElement("h1");C.textContent=ee(n,k,r),C.className="flex-start w-full font-semibold text-lg py-2 text-zinc-800 dark:text-zinc-50",o.appendChild(C);const m=document.createElement("div");if(m.className="no-folder-list container my-6 gap-x-8 gap-y-6 grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 w-full",m.id=`no-folder-list-${k}`,b.children){for(const p of b.children)if(!p.children&&p.url&&(!n||U(p.title,n)||U(p.url,n))){const M=J(p,n,bookmarkNode.title);m.appendChild(M)}}if(o.appendChild(m),b.children){for(const p of b.children)if(p.children){const y=oe(p,n);y&&o.appendChild(y)}}if(r===0){const p=document.createElement("p");p.textContent=n?`No bookmarks found matching "${n}"`:"No bookmarks found.",p.className="text-zinc-500 dark:text-zinc-400 mt-4",o.appendChild(p)}return}}(g.children||[]).forEach(function(w){if(w.children){const b=oe(w,n);if(b){l.push(b);const C=Y(w,n);r+=C}}})}const f=document.createElement("h1");if(f.textContent=ee(n,k,r),f.className="flex-start w-full font-semibold text-lg py-2 text-zinc-800 dark:text-zinc-50",o.appendChild(f),l.forEach(g=>{o.appendChild(g)}),window.updateBookmarkCards&&window.updateBookmarkCards(),r===0){const g=document.createElement("p");g.textContent=n?`No bookmarks found matching "${n}"`:"No bookmark folders found.",g.className="text-zinc-500 dark:text-zinc-400 mt-4",o.appendChild(g)}}});console.log("Keyboard shortcuts integrated into main.js");function Se(){console.log("💾 Triggering save changes...");const t=window.currentBookmarkNode;if(!t){console.error("❌ No current bookmark node found");return}const o=document.getElementById("edit-title"),d=document.getElementById("edit-url"),i=document.getElementById("folder-dropdown");if(!o||!d||!i){console.error("❌ Edit modal inputs not found");return}const c=o.value.trim(),a=d.value.trim(),s=i.value;if(!c||!a){console.log("❌ Title or URL is empty");return}console.log("📝 Saving bookmark:",{newTitle:c,newUrl:a,newParentId:s}),chrome.bookmarks.update(t.id,{title:c,url:a},function(){console.log("✅ Updated bookmark title and URL"),s!==t.parentId?chrome.bookmarks.move(t.id,{parentId:s},function(){console.log("✅ Moved bookmark to new folder"),u()}):u()});function u(){if(console.log("✅ Save completed, closing modal"),window.closeEditModal)window.closeEditModal();else{const x=document.getElementById("edit-modal");x&&x.classList.add("hidden")}window.updateBookmarkCards&&window.updateBookmarkCards(),setTimeout(()=>{location.reload()},500)}}function Ae(t){if(console.log("🔧 Triggering edit action for card:",t),!window.getBookmarkFromCard||!window.openEditModal){console.error("Required functions not available");return}const o=window.getBookmarkFromCard(t);console.log("📋 Extracted bookmark data:",o),o?(console.log("✅ Opening edit modal for:",o.title),console.log("📝 Full bookmark data being passed:",{id:o.id,title:o.title,url:o.url,parentId:o.parentId}),window.openEditModal(o),console.log("📝 Edit modal function called")):(console.error("❌ Could not extract bookmark data from card"),console.log("Card HTML:",t.outerHTML))}function ze(t){if(console.log("🗑️ Triggering delete action for card:",t),!window.getBookmarkFromCard||!window.deleteBookmark){console.error("Required functions not available");return}const o=window.getBookmarkFromCard(t);if(o&&confirm(`Are you sure you want to delete the bookmark "${o.title}"?`)){console.log("✅ Confirmed deletion of bookmark:",o.title);const d=Array.from(document.querySelectorAll(".card")),i=d.indexOf(t),c=d[i+1]||d[i-1];console.log("📍 Current card index:",i,"Next card found:",!!c),X(null),window.deleteBookmark(o),console.log("🗑️ Delete function called for bookmark"),setTimeout(()=>{window.updateBookmarkCards&&window.updateBookmarkCards();const a=Array.from(document.querySelectorAll(".card"));let s=null;if(c&&document.contains(c))s=c;else if(a.length>0){const u=Math.min(i,a.length-1);s=a[u]}s?(s.focus(),X(s),console.log("🎯 Focused and highlighted card after deletion:",s.querySelector("h3")?.textContent||"Unknown title")):console.log("❌ No card available to focus after deletion")},300)}else o?console.log("❌ User cancelled deletion"):console.error("❌ Could not extract bookmark data from card")}function Me(t){if(console.log("📸 Triggering capture action for card:",t),!window.getBookmarkFromCard||!window.captureScreenshot){console.error("Required functions not available");return}const o=window.getBookmarkFromCard(t);o?(console.log("✅ Capturing screenshot for:",o.title,"URL:",o.url),window.captureScreenshot(o.url,o.title,function(d,i){console.log("📸 Screenshot capture completed for:",o.title),document.querySelectorAll(".card").forEach(a=>{if(a.querySelector('a[href="'+o.url+'"]')){const u=a.querySelector('img[alt="'+o.url+'"]');u&&(u.src=i,console.log("🖼️ Updated thumbnail for:",o.title))}})})):console.error("❌ Could not extract bookmark data from card")}function De(t){console.log("🔗 Triggering open URL for card:",t);const o=t.querySelector("a");o&&o.href?(console.log("Opening link:",o.href),window.open(o.href,"_blank")):console.log("No link found in card")}function X(t){document.querySelectorAll(".card").forEach(o=>{o.style.outline="",o.style.boxShadow=""}),t?(t.style.outline="3px solid #3b82f6",t.style.boxShadow="0 0 0 1px #3b82f6",console.log("🎯 Highlighted focused card:",t.querySelector("h3")?.textContent||"Unknown title")):console.log("🔄 Cleared all card highlights")}let Q=-1,N=[],re=[];function be(){N=Array.from(document.querySelectorAll(".card")),console.log("🔄 Updated bookmark cards array:",N.length,"cards found"),N.forEach((t,o)=>{t.setAttribute("tabindex","0"),t.setAttribute("data-bookmark-index",o)})}window.updateBookmarkCards=be;function we(){const t=document.querySelector(".absolute.z-10.flex.flex-col.bg-zinc-800.w-44.h-32.rounded");t&&(t.remove(),console.log("✅ Bookmark menu closed")),re=[],N[Q]&&N[Q].focus()}function Te(){const t=[],o=document.getElementById("search-input"),d=document.getElementById("filter"),i=document.getElementById("recents-view"),c=document.getElementById("folder-view"),a=document.getElementById("settings-btn");o&&t.push(o),d&&t.push(d),i&&t.push(i),c&&t.push(c);const s=document.getElementById("folder-list");if(s){const u=Array.from(s.children);for(let x of u){const A=x.querySelectorAll("h1, h2");if(A.forEach(k=>{k.setAttribute("tabindex","0"),t.push(k);let B=null,v=k.nextElementSibling;for(;v&&!B;){if(v.classList&&v.classList.contains("card")){B=v;break}const z=v.querySelector?v.querySelector(".card"):null;if(z){B=z;break}v=v.nextElementSibling}B||(B=x.querySelector(".card")),B&&t.push(B)}),A.length===0){const k=x.querySelector(".card");k&&t.push(k)}}}return a&&t.push(a),t.filter(u=>u&&!u.hidden&&!u.disabled&&getComputedStyle(u).display!=="none")}function Ue(t){if(console.log("🧭 handleBookmarkNavigation called with key:",t.key),N.length===0)return console.log("❌ No bookmark cards found"),!1;const o=document.activeElement;console.log("🎯 Currently focused element:",o.tagName,"Classes:",o.className);const d=o.classList.contains("card");if(console.log("📋 Is bookmark card focused?",d),!d)return console.log("❌ Not focused on a bookmark card, skipping navigation"),!1;let i=null;if(i=o.closest('[class*="grid-cols"]'),i||(i=o.closest('[class*="grid"]')),i||(i=o.closest("#folder-list > *")),i||(i=document.getElementById("folder-list")),!i)return console.log("❌ Could not find parent container for navigation"),!1;console.log("🎯 Found parent container:",i.className);const c=Array.from(i.querySelectorAll(".card")),a=c.indexOf(o);if(a===-1)return console.log("❌ Current card not found in container"),!1;console.log("📍 Current card index:",a,"of",c.length,"cards");let s=a;const u=i.offsetWidth,x=240;let A=Math.max(1,Math.floor(u/x));if(i.classList.contains("grid")||i.className.includes("grid-cols")){const v=window.getComputedStyle(i).gridTemplateColumns;if(v&&v!=="none"){const z=v.split(" ").length;z>0&&(A=z,console.log("📊 Detected CSS grid with",A,"columns"))}}switch(console.log("📏 Container width:",u,"Card width:",x,"Cards per row:",A),t.key){case"ArrowRight":s=(a+1)%c.length,console.log("➡️ Moving right from",a,"to",s);break;case"ArrowLeft":s=a===0?c.length-1:a-1,console.log("⬅️ Moving left from",a,"to",s);break;case"ArrowDown":s=Math.min(a+A,c.length-1),console.log("⬇️ Moving down from",a,"to",s,"(+"+A+")");break;case"ArrowUp":s=Math.max(a-A,0),console.log("⬆️ Moving up from",a,"to",s,"(-"+A+")");break;default:return!1}t.preventDefault();const k=c[s];return k&&(Q=c.indexOf(k),k.focus(),X(k),k.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})),!0}function Fe(t){if(t.key!=="Tab")return!1;const o=document.getElementById("settings-modal");if(o&&!o.classList.contains("hidden"))return qe(t);const d=document.getElementById("edit-modal");if(d&&!d.classList.contains("hidden"))return $e(t);const i=Te(),c=document.activeElement;let a=i.indexOf(c);if(a===-1&&c.classList.contains("card")){const x=c.closest('.grid, [class*="grid"]')||c.closest("#folder-list > *");if(x){const A=x.querySelector(".card");a=i.indexOf(A)}}a===-1&&(a=-1);let s;t.shiftKey?s=a<=0?i.length-1:a-1:s=(a+1)%i.length,t.preventDefault();const u=i[s];return u.classList.contains("card")&&(Q=parseInt(u.getAttribute("data-bookmark-index"))),u.focus(),u.scrollIntoView&&u.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"}),!0}function $e(t){console.log("🔄 Edit modal tab navigation");const o=[document.getElementById("edit-title"),document.getElementById("edit-url"),document.getElementById("folder-dropdown"),document.getElementById("cancel-edit"),document.getElementById("save-edit")].filter(s=>s&&!s.disabled&&!s.hidden);if(console.log("📋 Modal elements found:",o.length),o.length===0)return console.log("❌ No focusable elements found in modal"),!1;const d=document.activeElement;let i=o.indexOf(d);console.log("🎯 Current element index:",i,"Element:",d.id||d.tagName);let c;t.shiftKey?(c=i<=0?o.length-1:i-1,console.log("⬅️ Shift+Tab: moving to index",c)):(c=(i+1)%o.length,console.log("➡️ Tab: moving to index",c)),t.preventDefault(),t.stopPropagation();const a=o[c];return a&&(a.focus(),console.log("✅ Focused element:",a.id||a.tagName)),!0}function qe(t){console.log("🔄 Settings modal tab navigation");const o=[document.querySelector('button[data-theme="auto"]'),document.querySelector('button[data-theme="light"]'),document.querySelector('button[data-theme="dark"]'),document.querySelector('a[href="https://tally.so/r/n0xjLP"]'),document.querySelector('a[href="https://www.buymeacoffee.com/snmbala"]')].filter(s=>s&&!s.disabled&&!s.hidden);if(console.log("⚙️ Settings modal elements found:",o.length),o.length===0)return console.log("❌ No focusable elements found in settings modal"),!1;const d=document.activeElement;let i=o.indexOf(d);console.log("🎯 Current settings element index:",i,"Element:",d.textContent||d.tagName);let c;t.shiftKey?(c=i<=0?o.length-1:i-1,console.log("⬅️ Shift+Tab: moving to index",c)):(c=(i+1)%o.length,console.log("➡️ Tab: moving to index",c)),t.preventDefault(),t.stopPropagation();const a=o[c];return a&&(a.focus(),console.log("✅ Focused settings element:",a.textContent||a.tagName)),!0}function Re(){console.log("Setting up integrated keyboard event listeners..."),document.addEventListener("keydown",function(t){console.log("Key pressed:",t.key,"Target:",t.target.tagName,"ID:",t.target.id,"Classes:",t.target.className);const o=document.getElementById("edit-modal");if(o&&!o.classList.contains("hidden")&&t.key==="Enter"&&(t.target.id==="edit-title"||t.target.id==="edit-url"||t.target.id==="save-edit")){console.log("💾 Enter key pressed in edit modal - saving changes"),t.preventDefault(),t.stopPropagation(),Se();return}const d=document.activeElement;if(d&&d.classList.contains("card")){if(X(d),t.key.toLowerCase()==="e"){console.log("✏️ E key pressed - opening edit modal"),t.preventDefault(),Ae(d);return}if(t.key==="Delete"||t.key==="Backspace"){console.log("🗑️ Delete key pressed - deleting bookmark"),t.preventDefault(),ze(d);return}if(t.key.toLowerCase()==="c"){console.log("📸 C key pressed - capturing screenshot"),t.preventDefault(),Me(d);return}if(t.key==="Enter"){console.log("🔗 Enter key pressed - opening bookmark link"),t.preventDefault(),De(d);return}}else console.log("🔍 Active element is not a card. Element:",d.tagName,"Classes:",d.className);if(!Fe(t)){if(Ue(t)){re.length>0&&we();return}if(t.key==="Escape"){console.log("Escape key pressed - unfocusing elements"),console.log("Current active element:",document.activeElement.tagName,document.activeElement.id),t.preventDefault();const i=document.getElementById("edit-modal");if(i&&!i.classList.contains("hidden")){window.closeEditModal?window.closeEditModal():(i.classList.add("hidden"),window.lastFocusedElement&&document.contains(window.lastFocusedElement)&&(window.lastFocusedElement.focus(),window.lastFocusedElement=null)),console.log("Closed edit modal");return}const c=document.getElementById("settings-modal");if(c&&!c.classList.contains("hidden")){c.classList.add("hidden");const u=document.getElementById("settings-btn");u&&(u.focus(),console.log("🎯 Restored focus to settings button")),console.log("Closed settings modal");return}if(re.length>0){we();return}const a=document.getElementById("search-input");if(a&&document.activeElement===a){a.blur(),console.log("Unfocused search input");return}const s=document.getElementById("filter");if(s&&document.activeElement===s){s.blur(),console.log("Unfocused filter dropdown");return}if(document.activeElement&&document.activeElement!==document.body){document.activeElement.blur(),console.log("Unfocused active element:",document.activeElement.tagName);return}console.log("No element to unfocus");return}if((t.target.tagName==="INPUT"||t.target.tagName==="TEXTAREA"||t.target.isContentEditable)&&t.target.id!=="filter"){console.log("Skipping - user is typing in input field");return}if(t.key.toLowerCase()==="s"){console.log("S key pressed - focusing search"),t.preventDefault(),window.scrollTo({top:0,behavior:"smooth"});const i=document.getElementById("search-input");i&&(i.focus(),i.value&&i.select());return}if(t.key.toLowerCase()==="f"){console.log("F key pressed - toggling filter"),t.preventDefault(),window.scrollTo({top:0,behavior:"smooth"});const i=document.getElementById("filter");if(i)if(document.activeElement===i)i.blur();else if(i.focus(),i.showPicker)i.showPicker();else{const c=i.getBoundingClientRect(),a=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0,clientX:c.left+c.width-20,clientY:c.top+c.height/2});i.dispatchEvent(a)}return}if(t.key.toLowerCase()==="r"){console.log("R key pressed - refreshing page"),t.preventDefault(),window.location.reload();return}if(t.key.toLowerCase()==="h"){console.log("H key pressed - opening settings"),t.preventDefault();const i=document.getElementById("settings-btn"),c=document.getElementById("settings-modal");i&&c&&i.click();return}if(t.key==="/"){const i=document.getElementById("search-input");i&&document.activeElement!==i&&(t.preventDefault(),i.focus())}}})}function ke(){console.log("Initializing integrated keyboard shortcuts..."),Re();const t=new MutationObserver(()=>{be()}),o=document.getElementById("folder-list");o&&(t.observe(o,{childList:!0,subtree:!0}),console.log("DOM observer set up for folder-list"))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ke):setTimeout(ke,100);
