function X(){const f=document.documentElement,m=document.getElementById("settings-icon-svg");m&&(f.classList.contains("dark")?m.querySelectorAll("path").forEach(g=>{g.setAttribute("stroke","#a5b4fc")}):m.querySelectorAll("path").forEach(g=>{g.setAttribute("stroke","#4f46e5")}))}function ge(){const f=document.querySelectorAll(".theme-toggle-btn");if(!f.length)return;const m=document.documentElement;function g(d){chrome?.storage?.sync?chrome.storage.sync.get(["appearanceMode"],u=>d(u.appearanceMode||"auto")):d(localStorage.getItem("appearanceMode")||"auto")}function b(d){chrome?.storage?.sync?chrome.storage.sync.set({appearanceMode:d}):localStorage.setItem("appearanceMode",d)}function L(d){f.forEach((u,$)=>{u.classList.remove("bg-indigo-50","border-2","border-indigo-400","text-indigo-700","bg-white","text-zinc-500","dark:bg-indigo-500/10","dark:border-indigo-400","dark:text-indigo-200","dark:bg-zinc-700","dark:text-zinc-300","rounded-l-md","rounded-r-md"),u.classList.add("bg-white","text-zinc-500","dark:bg-zinc-700","dark:text-zinc-300"),$===0&&u.classList.add("rounded-l-md"),$===f.length-1&&u.classList.add("rounded-r-md"),d==="auto"&&u.getAttribute("data-theme")==="auto"||d==="light"&&u.getAttribute("data-theme")==="light"||d==="dark"&&u.getAttribute("data-theme")==="dark"?(u.classList.remove("bg-white","text-zinc-500","dark:bg-zinc-700","dark:text-zinc-300"),u.classList.add("bg-indigo-50","border-2","border-indigo-400","text-indigo-700","dark:bg-indigo-500/10","dark:border-indigo-400","dark:text-indigo-200")):u.classList.remove("border-2","border-indigo-400","text-indigo-700","dark:bg-indigo-500/10","dark:border-indigo-400","dark:text-indigo-200")})}function C(d){d==="dark"?m.classList.add("dark"):d==="light"?m.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches?m.classList.add("dark"):m.classList.remove("dark"),X()}g(d=>{L(d),C(d)}),f.forEach(d=>{d.addEventListener("click",()=>{const u=d.getAttribute("data-theme");b(u),L(u),C(u)})}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",d=>{g(u=>{u==="auto"&&C("auto")})})}function ce(f,m,g){if(!f){console.error("URL is empty");return}const b=1024,L=683;chrome.windows.create({url:f,type:"popup",width:b,height:L,left:Math.round((screen.width-b)/2),top:Math.round((screen.height-L)/2)},function(C){C.tabs[0].id,chrome.tabs.onUpdated.addListener(function d(u,$){u===u&&$.status==="complete"&&(chrome.tabs.onUpdated.removeListener(d),setTimeout(function(){chrome.tabs.captureVisibleTab(C.id,{format:"png"},function(T){T?pe(T,100,function(k){ve(f,k),g&&typeof g=="function"&&g(f,k)}):console.error("Failed to capture screenshot for URL:",f),chrome.windows.remove(C.id)})},1e3))})})}function pe(f,m,g){const b=new Image;b.src=f,b.onload=function(){const L=document.createElement("canvas"),C=L.getContext("2d");L.width=1024,L.height=683,C.drawImage(b,0,0,L.width,L.height);let d=1;for(;;){const u=L.toDataURL("image/jpeg",d);if(u.length/1024<=m||d<=.1){g(u);break}else d-=.1}}}function ve(f,m){const g=f,b=m;chrome.storage.local.set({[g]:b},function(){chrome.runtime.lastError&&console.error(chrome.runtime.lastError.message)})}function se(f,m){const g=f;chrome.storage.local.get([g],function(b){if(chrome.runtime.lastError)m(`https://www.google.com/s2/favicons?domain=${f}`);else{const L=b[g];m(L||`https://www.google.com/s2/favicons?domain=${f}`)}})}chrome.bookmarks.getTree(function(f){const m=document.getElementById("folder-list"),g=document.getElementById("search-input"),b=document.getElementById("clear-search"),L=document.getElementById("search-icon"),C=document.getElementById("filter"),d=document.getElementById("folder-view"),u=document.getElementById("recents-view"),$=document.getElementById("recents-icon"),T=document.getElementById("settings-btn");let k=0,I=!0,B=[],A=[{label:"All",value:"all",level:0,id:0}],R={data:null,timestamp:0};const re=5e3;function ae(e,t){let i;return function(...l){const s=()=>{clearTimeout(i),e(...l)};clearTimeout(i),i=setTimeout(s,t)}}function ee(){const e=Date.now();return R.data&&e-R.timestamp<re?Promise.resolve(R.data):new Promise(t=>{chrome.bookmarks.getTree(i=>{R.data=i,R.timestamp=e,t(i)})})}ge(),document.addEventListener("DOMContentLoaded",X),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",X);let _=!1;const H=document.getElementById("settings-modal");T.addEventListener("click",function(e){e.stopPropagation(),H.classList.toggle("hidden"),_=!H.classList.contains("hidden")}),H.addEventListener("click",function(e){e.stopPropagation()}),document.addEventListener("click",function(){_&&!H.classList.contains("hidden")&&(H.classList.add("hidden"),_=!1)});function G(e,t=""){if(e.children){t=e.title;for(const i of e.children)G(i,t)}else B.push({bookmark:e,folder:t})}for(const e of f[0].children)G(e);let q=B.sort((e,t)=>{const i=e.bookmark.dateLastUsed||e.bookmark.dateAdded;return(t.bookmark.dateLastUsed||t.bookmark.dateAdded)-i});const de=ae(function(e){I?S(e):U(f,e)},300);g.addEventListener("input",function(){if(g.value){b.classList.remove("hidden"),document.activeElement===g?L.src="assets/icons/search-blue.svg":L.src="assets/icons/search.svg";const e=g.value.trim().toLowerCase();de(e)}else b.classList.add("hidden"),L.src="assets/icons/search.svg",I?S(""):U(f,"")}),b.addEventListener("click",function(){g.value="",b.classList.add("hidden"),L.src="assets/icons/search.svg",I?S(""):U(f,"")});function te(){I=!I,g.value="",b.classList.add("hidden"),L.src="assets/icons/search.svg",C.value="all",k=0,W();const e="",t=document.querySelectorAll(".folder-icon"),i=document.getElementById("settings-icon-svg");I?(t.forEach(n=>{n.style.fill="none",n.style.stroke="#a1a1aa"}),d.classList.remove("active"),d.classList.add("in-active"),$.style.fill="#4f46e5",$.style.stroke="#4f46e5",u.classList.add("active"),u.classList.remove("in-active"),i&&i.querySelectorAll("path").forEach(n=>{n.setAttribute("stroke","#4f46e5")}),S(e)):(t.forEach(n=>{n.style.fill="#4f46e5",n.style.stroke="#4f46e5"}),d.classList.add("active"),d.classList.remove("in-active"),$.style.stroke="#a1a1aa",$.style.fill="none",u.classList.remove("active"),u.classList.add("in-active"),i&&i.querySelectorAll("path").forEach(n=>{n.setAttribute("stroke","#a1a1aa")}),U(f,e))}function S(e){q=B.sort((o,c)=>{const w=o.bookmark.dateLastUsed||o.bookmark.dateAdded;return(c.bookmark.dateLastUsed||c.bookmark.dateAdded)-w});let t=q.filter(o=>{const c=!e||M(o.bookmark.title,e)||M(o.bookmark.url,e);if(k&&k!==0&&k!=="all"){const w=o.bookmark.parentId==k;return c&&w}return c});m.innerHTML="",document.querySelectorAll("[data-scroll-handler]").forEach(o=>{o.scrollHandler&&window.removeEventListener("scroll",o.scrollHandler)});const n=document.createElement("h1");n.textContent=Y(e,k,t.length),n.className="flex-start w-full font-semibold text-lg py-2 text-zinc-800 dark:text-zinc-50";const l=document.createElement("div");l.className="w-fit",m.appendChild(l);const s=document.createElement("div");s.className="container mx-auto grid my-6 grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8",l.appendChild(n),l.appendChild(s);const r=100;let p=0,a=!1;s.setAttribute("data-scroll-handler","true");function v(){if(a)return;a=!0;const o=p*r,c=Math.min(o+r,t.length),w=document.createDocumentFragment();for(let x=o;x<c;x++){const y=t[x];if(!y.children){const h=K(y.bookmark,e);w.appendChild(h)}}s.appendChild(w),p++,a=!1}function E(){const o=()=>{window.innerHeight+window.scrollY>=document.documentElement.scrollHeight-200&&p*r<t.length&&!a&&v()};window.addEventListener("scroll",o),s.scrollHandler=o}if(t.length>0&&(v(),t.length>r&&E()),t.length===0){const o=document.createElement("p");o.textContent=e?`No bookmarks found matching "${e}"`:"No bookmarks found.",o.className="text-zinc-500 dark:text-zinc-400 mt-4",l.appendChild(o)}}function K(e,t){const i=document.createElement("div");i.className="relative card min-w-60 flex flex-col border-[1.5px] bg-white border-zinc-200; dark:border-zinc-700 hover:border-indigo-500 hover:shadow-md hover:shadow-indigo-100 dark:hover:shadow-indigo-700 rounded-md overflow-hidden";const n=document.createElement("button");n.className="absolute top-0 right-0 m-1 p-1 bg-zinc-500 hover:bg-zinc-600 dark:bg-zinc-700 dark:hover:bg-zinc-800 rounded-full border-none cursor-pointer close-button",n.addEventListener("click",function(x){x.stopPropagation(),ue(x,e)});const l=document.createElement("img");l.src="assets/icons/more.svg",l.alt="Close",l.className="h-4 w-4",n.appendChild(l),i.appendChild(n);const s=document.createElement("a");s.href=e.url,s.target="_blank",s.className="flex-center flex-col gap-3 card-thumbnail w-full h-40 border-b-[1.5px] bg-zinc-100 dark:bg-zinc-700 dark:border-zinc-600",se(e.url,function(x){const y=document.createElement("img");if(y.src=x,y.alt=e.url||"Bookmark thumbnail",s.appendChild(y),e.title,x.startsWith("https://www.google.com/s2/favicons?domain=")){const h=document.createElement("button");h.textContent="Capture Thumbnail",h.className="text-zinc-800 dark:text-zinc-200 border-zinc-300 dark:border-zinc-700 bg-white hover:bg-zinc-50 dark:bg-zinc-800 dark:hover:bg-zinc-900 font-semibold py-2 px-4 border shadow rounded-full",h.id="capture-"+e.url,h.addEventListener("click",function(D){D.preventDefault(),ce(e.url,e.title,function(J,F){y.src=F,h.parentNode&&h.parentNode.removeChild(h)})}),s.appendChild(h)}}),i.appendChild(s),s.addEventListener("click",function(x){const y=new Date().getTime();for(const h of B)if(h.bookmark.id===e.id){h.bookmark.dateLastUsed=y;break}});const r=document.createElement("div");r.className="flex-center h-24 flex-col bg-white dark:bg-zinc-800 px-2 py-4";const p=document.createElement("div");p.className="flex-start w-full h-5";const a=document.createElement("a");a.className="flex-start text-base font-medium text-zinc-800 dark:text-zinc-50 whitespace-nowrap overflow-hidden text-ellipsis",a.href=e.url,a.target="_blank",a.innerHTML=P(e.title||"Untitled",t),p.appendChild(a),a.addEventListener("click",function(x){const y=new Date().getTime();for(const h of B)if(h.bookmark.id===e.id){h.bookmark.dateLastUsed=y;break}}),r.appendChild(p),setTimeout(()=>{a.offsetWidth>216&&p.classList.add("text-scroll")},0);const v=document.createElement("div");v.className="flex-start w-full h-5 overflow-hidden";const E=document.createElement("p");E.className="flex-start text-zinc-800 dark:text-zinc-300 whitespace-nowrap",E.title=e.url;const o=new URL(e.url);let c=o.hostname.replace(/^www\./,"");const w=o.pathname;if(w&&w!=="/"?c=P(c,t)+`<span class="text-zinc-400 whitespace-nowrap">${P(w,t)}</span>`:c=P(c,t),E.innerHTML=c,v.appendChild(E),r.appendChild(v),I){let x="";const y=B.find(h=>h.bookmark.id===e.id);if(y&&y.folder)x=y.folder;else{const h=A.find(D=>D.value===e.parentId);h&&(x=h.label.replace(/^[-\s]+/,""))}if(x){const h=document.createElement("div");h.className="flex-start w-full mt-1";const D=document.createElement("span");D.textContent=x,D.className="flex-center w-fit h-5 px-2 py-0.5 rounded-md bg-zinc-200 dark:bg-zinc-700 dark:text-zinc-50 border border-zinc-300 dark:border-zinc-600 text-xs font-medium",h.appendChild(D),r.appendChild(h)}}return i.appendChild(r),i}u.addEventListener("click",te),d.addEventListener("click",te),C.addEventListener("change",function(e){k=e.target.value=="all"?0:e.target.value;const t=g.value.trim().toLowerCase();W(),I?S(t):U(f,t)});function M(e,t){return!e||!t?!1:t.toLowerCase().split(" ").every(n=>e.toLowerCase().includes(n))}function P(e,t){if(!t||!e)return e;const i=t.toLowerCase().split(/\s+/).filter(l=>l.length>0);let n=e;return i.forEach(l=>{const s=new RegExp(`(${l})`,"gi");n=n.replace(s,'<mark class="bg-yellow-200 dark:bg-yellow-600 dark:text-zinc-100 px-0.5 rounded-sm">$1</mark>')}),n}function Y(e,t,i){const n=e&&e.trim().length>0,l=t&&t!==0&&t!=="all";let s="",r="";if(l){const p=A.find(a=>a.value==t);p&&(s=p.label.replace(/^[\s\-]*/,""),r=s.includes("- ")?s.replace(/\s*-\s*/g," > "):s)}return n&&l?i===0?`No results for "${e}" in ${r}`:`Results for "${e}" in ${r} (${i})`:n?i===0?`No results for "${e}"`:`Results for "${e}" (${i})`:l?`Folder: ${r} (${i})`:I?`Recent Bookmarks (${i})`:`Bookmarks (${i})`}function we(e,t){}let z=null,V=null;function ue(e,t){z&&z.remove(),V=t;const i=document.getElementById("folder-dropdown");if(i&&i.children.length===0&&A.slice(1).forEach(function(p){const a=document.createElement("option");a.value=p.value,a.textContent=p.label,a.selected=p.value===V.parentId,i.appendChild(a)}),z&&z.previousElementSibling===e.target){z.remove(),z=null;return}if(z){r();return}const n=document.createElement("div");n.className="absolute z-10 flex flex-col bg-zinc-800 w-44 h-32 rounded shadow-md text-zinc-100 hover:text-zinc-50 text-sm font-light flex-center flex-col";function l(p,a,v,E){const o=document.createElement("div");o.className="flex-start w-full h-9 px-3 py-1.5 hover:bg-zinc-700 active:bg-zinc-700";const c=document.createElement("img");c.src=a,c.alt=p,c.className="w-4 h-4 mr-3",o.appendChild(c);const w=document.createElement("button");return w.textContent=p,w.className=v||"flex-start text-left",w.addEventListener("click",E),o.appendChild(w),o}se(t.url,function(p){const a=p.startsWith("https://www.google.com/s2/favicons?domain=")?"Capture Thumbnail":"Recapture",v=l(a,"assets/icons/camera.svg",null,function(c){c.preventDefault(),ce(t.url,t.title,function(w,x){document.querySelectorAll(".card").forEach(h=>{if(h.querySelector('a[href="'+t.url+'"]')){const J=h.querySelector('img[alt="'+t.url+'"]');J&&(J.src=x);const F=h.querySelector("#capture-"+t.url);F&&F.parentNode&&F.parentNode.removeChild(F)}})}),r()});n.appendChild(v);const E=l("Edit","assets/icons/edit.svg",null,function(c){r(),c.preventDefault(),fe(t)});n.appendChild(E);const o=l("Delete","assets/icons/trash.svg","flex-grow text-left",function(c){c.preventDefault(),confirm("Are you sure you want to delete this bookmark?")&&me(t),r()});n.appendChild(o)});const s=e.target.getBoundingClientRect();n.style.top=`${s.bottom+window.scrollY+4}px`,n.style.right=`${window.innerWidth-s.right-4}px`,document.body.appendChild(n),z=n;function r(){z&&(z.remove(),z=null,document.removeEventListener("click",r))}document.addEventListener("click",r),e.stopPropagation()}function fe(e){const t=document.getElementById("edit-modal"),i=document.getElementById("edit-title"),n=document.getElementById("edit-url");i.value=e.title||"",n.value=e.url||"",t.classList.remove("hidden")}function O(){document.getElementById("edit-modal").classList.add("hidden")}function me(e){const t=e.url;chrome.bookmarks.remove(e.id,function(){console.log(`Deleted bookmark: ${e.title}`),chrome.storage.local.remove([t],function(){B=B.filter(n=>n.bookmark.id!==e.id),q=B.sort((n,l)=>{const s=n.bookmark.dateLastUsed||n.bookmark.dateAdded;return(l.bookmark.dateLastUsed||l.bookmark.dateAdded)-s});const i=g.value.trim().toLowerCase();I?S(i):ee().then(function(n){m.innerHTML="",U(n,i)})})})}function ne(e,t=0,i=""){e&&e.length>0&&e.forEach(function(n){n.children?(n.title&&A.push({label:`${t>0?"-".repeat(t-1)+" ":""}`+n.title,value:n.id,level:t,id:i+"-"+n.id+"-"}),ne(n.children,t+1,i+"-"+n.id)):n.parentId&&!A.find(l=>l.value===n.parentId)&&A.push({label:`Unknown Folder (${n.parentId})`,value:n.parentId,level:0,id:`unknown-${n.parentId}`})})}ne(f),A.forEach(function(e){const t=document.createElement("option");t.value=e.value,t.textContent=e.label,t.className="flex-center flex-col bg-zinc-100 w-44 h-32 rounded shadow-md text-zinc-800 text-sm font-normal cursor-pointer py-5",C.appendChild(t)});function W(){const e=document.getElementById("filter"),t=document.getElementById("filter-dropdown-arrow"),i=document.getElementById("filter-clear");e&&t&&i&&(e.value&&e.value!=="all"?(t.classList.add("hidden"),i.classList.remove("hidden")):(t.classList.remove("hidden"),i.classList.add("hidden")))}setTimeout(()=>{const e=document.getElementById("filter"),t=document.getElementById("filter-clear");W(),t&&t.addEventListener("click",function(){if(e){e.value="all",k=0,W();const i=g.value.trim().toLowerCase();I?S(i):U(f,i)}})},100),S("");const ie=document.getElementById("cancel-edit"),oe=document.getElementById("save-edit"),j=document.getElementById("edit-modal");ie&&ie.addEventListener("click",function(){O()}),oe&&oe.addEventListener("click",function(){if(V){const e=document.getElementById("edit-title"),t=document.getElementById("edit-url"),i=document.getElementById("folder-dropdown"),n=e.value.trim(),l=t.value.trim(),s=i.value;n&&l&&chrome.bookmarks.update(V.id,{title:n,url:l},function(){s!==V.parentId?chrome.bookmarks.move(V.id,{parentId:s},function(){O(),le()}):(O(),le())})}}),j&&j.addEventListener("click",function(e){e.target===j&&O()});function le(){const e=g.value.trim().toLowerCase();R={data:null,timestamp:0},ee().then(function(t){B=[];for(const i of t[0].children)G(i);q=B.sort((i,n)=>{const l=i.bookmark.dateLastUsed||i.bookmark.dateAdded;return(n.bookmark.dateLastUsed||n.bookmark.dateAdded)-l}),I?S(e):U(t,e)})}function Q(e){const t=A.find(i=>i.value===e);return t?t.id:`fallback-${e}`}function N(e,t){let i=0;if(e.children)for(const n of e.children)i+=N(n,t);else e.url&&(!t||M(e.title,t)||M(e.url,t))&&i++;return i}function he(e,t,i){const n=e.title,l=N(e,t),s=t&&t.trim().length>0,r=i&&i!==0&&i!=="all";return l===0?null:s&&r?`${n} - Results for "${t}" (${l})`:s?`${n} - Results for "${t}" (${l})`:r?`${n} (${l})`:`${n} (${l})`}function Z(e,t,i,n,l){const s=document.createElement("div");try{s.id=Q(e.id)}catch(r){console.error("Error computing ID for bookmark:",e.title,r),s.id=`fallback-${e.id}`}if(s.className=i||"flex-center flex-col m-auto gap-4",e.children&&e.children.length>0){const r=he(e,t,k);if(r===null)return null;const p=document.createElement("h2");try{p.id=Q(e.id)}catch(o){console.error("Error computing ID for folder title:",e.title,o),p.id=`fallback-title-${e.id}`}p.textContent=r||"Untitled",p.className=l||"container flex-start w-full text-semibold text-zinc-600 text-lg py-2 dark:text-zinc-200";const a=document.createElement("div");a.className=n||"all-sublist-container";const v=document.createElement("div");try{v.id=Q(e.id)}catch(o){console.error("Error computing ID for noFolderList:",o),v.id=`fallback-nofolder-${e.id}`}v.className="no-folder-list container my-6 gap-x-8 gap-y-6 grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 w-full";let E=[];for(const o of e.children)if(o.children){const c=Z(o,t,"sublist-container container w-full flex-center flex-col gap-3","","sublist-title container flex-start w-full text-semibold text-zinc-600 dark:text-zinc-300 text-lg py-2");c&&E.push(c)}else if(o.url&&(!t||M(o.title,t)||M(o.url,t))){const w=K(o,t);v.appendChild(w)}return a.appendChild(p),a.appendChild(v),E.forEach(o=>{a.appendChild(o)}),s.appendChild(a),s}return null}function U(e,t){m.innerHTML="";let i=0,n=[];if(e&&e.length>0){const r=e[0];if(k&&k!==0&&k!=="all"){let a=function(E,o){if(E.id===o)return E;if(E.children)for(const c of E.children){const w=a(c,o);if(w)return w}return null};var s=a;const v=a(r,k);if(v){i=N(v,t);const E=document.createElement("h1");E.textContent=Y(t,k,i),E.className="flex-start w-full font-semibold text-lg py-2 text-zinc-800 dark:text-zinc-50",m.appendChild(E);const o=document.createElement("div");if(o.className="no-folder-list container my-6 gap-x-8 gap-y-6 grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 w-full",o.id=`no-folder-list-${k}`,v.children){for(const c of v.children)if(!c.children&&c.url&&(!t||M(c.title,t)||M(c.url,t))){const x=K(c,t);o.appendChild(x)}}if(m.appendChild(o),v.children){for(const c of v.children)if(c.children){const w=Z(c,t);w&&m.appendChild(w)}}if(i===0){const c=document.createElement("p");c.textContent=t?`No bookmarks found matching "${t}"`:"No bookmarks found.",c.className="text-zinc-500 dark:text-zinc-400 mt-4",m.appendChild(c)}return}}(r.children||[]).forEach(function(a){if(a.children){const v=Z(a,t);if(v){n.push(v);const E=N(a,t);i+=E}}})}const l=document.createElement("h1");if(l.textContent=Y(t,k,i),l.className="flex-start w-full font-semibold text-lg py-2 text-zinc-800 dark:text-zinc-50",m.appendChild(l),n.forEach(r=>{m.appendChild(r)}),i===0){const r=document.createElement("p");r.textContent=t?`No bookmarks found matching "${t}"`:"No bookmark folders found.",r.className="text-zinc-500 dark:text-zinc-400 mt-4",m.appendChild(r)}}});
