function h(t,n,o){fetch(t).then(e=>e.blob()).then(e=>createImageBitmap(e)).then(e=>{const i=new OffscreenCanvas(1024,683);i.getContext("2d").drawImage(e,0,0,1024,683);let r=1,l=1/0;const m=()=>{i.convertToBlob({type:"image/jpeg",quality:r}).then(u=>{const a=u.size/1024;if(Math.abs(a-n)<1||r<=.1||a>=l){const c=new FileReader;c.onloadend=function(){o(c.result)},c.readAsDataURL(u)}else r-=.05,l=a,m()})};m()}).catch(e=>console.error(e))}chrome.action.onClicked.addListener(function(t){chrome.tabs.create({url:chrome.runtime.getURL("main.html")})});chrome.bookmarks.onCreated.addListener(function(t,n){chrome.tabs.captureVisibleTab(null,{format:"png"},function(o){o?h(o,100,function(s){key=n.url,value=s,console.log(t),chrome.storage.local.set({[key]:value},function(){chrome.runtime.lastError?console.error(chrome.runtime.lastError.message):console.log("Compressed screenshot captured and stored for bookmark with ID:",id)})}):console.error("Failed to capture screenshot for bookmark with ID:",id)})});
